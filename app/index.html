<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Elenweave - Agent Canvas</title>
    <meta name="description" content="Elenweave public demo app for canvas workspaces." />
    <link rel="icon" href="/favicons/favicon.ico" sizes="any" />
    <link rel="icon" type="image/png" sizes="32x32" href="/favicons/favicon-32x32.png" />
    <link rel="icon" type="image/png" sizes="16x16" href="/favicons/favicon-16x16.png" />
    <link rel="apple-touch-icon" sizes="180x180" href="/favicons/apple-touch-icon.png" />
    <link rel="manifest" href="/favicons/site.webmanifest" />

    <script>
      (function () {
        try {
          var saved = localStorage.getItem('elenweave_theme');
          var theme = (saved === 'dark' || saved === 'blueprint') ? saved : 'blueprint';
          document.documentElement.setAttribute('data-theme', theme);
        } catch (err) {
          document.documentElement.setAttribute('data-theme', 'blueprint');
        }
      })();
    </script>
    <script id="elenweave-runtime-config">
      window.__ELENWEAVE_RUNTIME__ = {
        storageMode: 'client',
        publicProjectsCatalogUrl: ''
      };
    </script>

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/elenweave@0.1.1/dist/styles.css" />
    <link rel="stylesheet" href="./app.css" />
  </head>
  <body>
    <div class="app-shell">
      <aside class="app-panel">
        <div class="app-brand-row">
          <a class="app-brand" href="https://elenweave.com" aria-label="Elenweave home">
            <img class="brand-mark" src="/logo.webp" alt="Elenweave logo" />
            <div>
              <h1>Elenweave</h1>
            </div>
          </a>
          <button
            class="btn ghost collapse-btn"
            id="panelToggle"
            type="button"
            aria-label="Collapse sidebar"
            title="Collapse sidebar"
            aria-pressed="false"
          >
            <span class="collapse-icon" aria-hidden="true"></span>
            <span class="sr-only">Toggle sidebar</span>
          </button>
        </div>

        <section class="panel-section panel-section--projects">
          <div class="section-title">Projects</div>
          <div class="project-switcher" aria-label="Project switcher">
            <div class="project-select-wrap">
              <label class="sr-only" for="projectSelect">Project</label>
              <select id="projectSelect" aria-label="Project"></select>
            </div>
            <button class="btn ghost project-rename-btn" id="btnRenameProject" type="button" aria-label="Rename project">
              <svg class="btn-icon" viewBox="0 0 36 36" aria-hidden="true">
                <path d="M33.87 8.32 28 2.42a2.07 2.07 0 0 0-2.92 0L4.27 23.2l-1.9 8.2a2.06 2.06 0 0 0 2 2.5 2 2 0 0 0 .43 0l8.29-1.9 20.78-20.76a2.07 2.07 0 0 0 0-2.92M12.09 30.2l-7.77 1.63 1.77-7.62L21.66 8.7l6 6ZM29 13.25l-6-6 3.48-3.46 5.9 6Z" fill="currentColor"></path>
              </svg>
              <span class="sr-only">Rename project</span>
            </button>
            <button class="btn accent project-add-btn" id="btnNewProject" type="button" aria-label="New project">+</button>
          </div>
        </section>

        <section class="panel-section panel-section--boards">
          <div class="section-title">Boards</div>
          <div class="btn-row board-actions">
            <button class="btn accent board-action-btn" id="btnNew" type="button" aria-label="New board" title="New board">
              <svg class="btn-icon" viewBox="0 0 16 16" aria-hidden="true">
                <path d="M8 3V13"></path>
                <path d="M3 8H13"></path>
              </svg>
              <span class="sr-only">New board</span>
            </button>
            <button class="btn ghost board-action-btn" id="btnSortBoards" type="button" aria-label="Sort boards by time" title="Sort boards by newest updated time">
              <svg class="btn-icon btn-icon-sort" viewBox="0 0 24 24" aria-hidden="true">
                <path d="M6.293 4.293a1 1 0 0 1 1.414 0l4 4a1 1 0 0 1-1.414 1.414L8 7.414V19a1 1 0 1 1-2 0V7.414L3.707 9.707a1 1 0 0 1-1.414-1.414zM16 16.586V5a1 1 0 1 1 2 0v11.586l2.293-2.293a1 1 0 0 1 1.414 1.414l-4 4a1 1 0 0 1-1.414 0l-4-4a1 1 0 0 1 1.414-1.414z" fill="currentColor"></path>
              </svg>
              <span class="sr-only">Sort boards by time</span>
            </button>
            <button class="btn ghost board-action-btn" id="btnShareBoard" type="button" aria-label="Share board" title="Share board">
              <svg class="btn-icon" viewBox="0 0 24 24" aria-hidden="true">
                <path d="M7.5 12a2.5 2.5 0 1 0 2.45 3H14a2 2 0 1 1 0 4H6a4 4 0 1 1 1.7-7.62" fill="currentColor"></path>
                <path d="M16.5 12a2.5 2.5 0 1 0-2.45-3H10a2 2 0 1 1 0-4h8a4 4 0 1 1-1.7 7.62" fill="currentColor"></path>
              </svg>
              <span class="sr-only">Share board</span>
            </button>
            <button class="btn ghost board-action-btn board-action-btn--danger" id="btnDeleteBoard" type="button" aria-label="Delete active board" title="Delete active board">
              <svg class="btn-icon btn-icon-delete" viewBox="0 0 24 24" aria-hidden="true">
                <path d="M7 4a2 2 0 0 1 2-2h6a2 2 0 0 1 2 2v2h4a1 1 0 1 1 0 2h-1.069l-.867 12.142A2 2 0 0 1 17.069 22H6.93a2 2 0 0 1-1.995-1.858L4.07 8H3a1 1 0 0 1 0-2h4zm2 2h6V4H9zM6.074 8l.857 12H17.07l.857-12zM10 10a1 1 0 0 1 1 1v6a1 1 0 1 1-2 0v-6a1 1 0 0 1 1-1m4 0a1 1 0 0 1 1 1v6a1 1 0 1 1-2 0v-6a1 1 0 0 1 1-1" fill="currentColor"/>
              </svg>
              <span class="sr-only">Delete active board</span>
            </button>
            <!-- <button class="btn" id="btnPrev" type="button">Prev</button> -->
            <!-- <button class="btn" id="btnNext" type="button">Next</button> -->
          </div>
          <div class="board-list" id="boardList" aria-label="Boards"></div>
        </section>

        <section class="settings-panel" id="settingsPanel" aria-label="Settings panel" hidden>
          <div class="settings-panel__header">
            <div class="section-title">Settings</div>
            <button class="btn ghost settings-close" id="settingsClose" type="button" aria-label="Close settings">Close</button>
          </div>
          <div class="settings-panel__group">
            <div class="section-title">AI</div>
            <div class="btn-row single">
              <button class="btn" id="btnModelMatrix" type="button">AI Model Config</button>
            </div>
            <div class="btn-row single">
              <button class="btn toggle" id="btnRealtime" type="button" aria-pressed="false">Realtime</button>
            </div>
          </div>
          <div class="settings-panel__group">
            <div class="section-title">Tools</div>
            <div class="btn-row single">
              <button class="btn toggle" id="btnLink" type="button" aria-pressed="false">Link Mode</button>
            </div>
            <div class="btn-row single">
              <button class="btn cycle" id="edgeToggle" type="button">Edges: Straight</button>
            </div>
            <div class="btn-row single">
              <button class="btn cycle" id="themeToggle" type="button">Theme</button>
            </div>
            <div class="btn-row">
              <button class="btn" id="btnExport" type="button">Export Board</button>
              <button class="btn ghost" id="btnImport" type="button">Import Board</button>
            </div>
          </div>
          <div class="settings-panel__group desktop-settings" id="desktopSettingsGroup" hidden>
            <div class="section-title">Desktop</div>
            <div class="desktop-runtime" id="desktopRuntimeInfo">Desktop runtime unavailable.</div>
            <label class="desktop-field" for="desktopPortInput">
              <span>Port</span>
              <input id="desktopPortInput" type="number" min="1" max="65535" step="1" placeholder="8787" />
            </label>
            <label class="desktop-field" for="desktopDataDirInput">
              <span>Data Directory</span>
              <input id="desktopDataDirInput" type="text" placeholder="C:\\Users\\you\\.elenweave" />
            </label>
            <label class="desktop-field" for="desktopConfigPathInput">
              <span>Config Path</span>
              <input id="desktopConfigPathInput" type="text" placeholder="C:\\Users\\you\\.elenweave\\config.json" />
            </label>
            <label class="desktop-field" for="desktopAiConfigPathInput">
              <span>AI Config Path</span>
              <input id="desktopAiConfigPathInput" type="text" placeholder="Optional" />
            </label>
            <div class="btn-row">
              <button class="btn" id="desktopSaveConfig" type="button">Save Desktop Config</button>
              <button class="btn ghost" id="desktopRestartServer" type="button">Restart Server</button>
            </div>
            <div class="btn-row">
              <button class="btn ghost" id="desktopOpenDataDir" type="button">Open Data Dir</button>
              <button class="btn ghost" id="desktopOpenConfigFile" type="button">Open Config File</button>
            </div>
          </div>
        </section>

        <div class="panel-footer">
          <div class="panel-footer-actions">
            <button
              class="btn footer-download"
              id="btnFooterDownload"
              type="button"
              aria-label="Download board"
              title="Download board"
            >
              <svg class="footer-download-icon" viewBox="0 0 24 24" aria-hidden="true" xmlns="http://www.w3.org/2000/svg">
                <path d="M12 2a1 1 0 0 1 1 1v10.586l2.293-2.293a1 1 0 0 1 1.414 1.414l-4 4a1 1 0 0 1-1.414 0l-4-4a1 1 0 1 1 1.414-1.414L11 13.586V3a1 1 0 0 1 1-1M5 17a1 1 0 0 1 1 1v2h12v-2a1 1 0 1 1 2 0v2a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2v-2a1 1 0 0 1 1-1" fill="currentColor"/>
              </svg>
              <span class="sr-only">Download board</span>
            </button>
          <button
            class="btn settings-toggle"
            id="settingsToggle"
            type="button"
            aria-expanded="false"
            aria-controls="settingsPanel"
            aria-label="Settings"
          >
            <svg class="settings-toggle-icon" viewBox="0 0 1024 1024" aria-hidden="true" xmlns="http://www.w3.org/2000/svg">
              <path d="M600.704 64a32 32 0 0 1 30.464 22.208l35.2 109.376c14.784 7.232 28.928 15.36 42.432 24.512l112.384-24.192a32 32 0 0 1 34.432 15.36L944.32 364.8a32 32 0 0 1-4.032 37.504l-77.12 85.12a357 357 0 0 1 0 49.024l77.12 85.248a32 32 0 0 1 4.032 37.504l-88.704 153.6a32 32 0 0 1-34.432 15.296L708.8 803.904c-13.44 9.088-27.648 17.28-42.368 24.512l-35.264 109.376A32 32 0 0 1 600.704 960H423.296a32 32 0 0 1-30.464-22.208L357.696 828.48a352 352 0 0 1-42.56-24.64l-112.32 24.256a32 32 0 0 1-34.432-15.36L79.68 659.2a32 32 0 0 1 4.032-37.504l77.12-85.248a357 357 0 0 1 0-48.896l-77.12-85.248A32 32 0 0 1 79.68 364.8l88.704-153.6a32 32 0 0 1 34.432-15.296l112.32 24.256c13.568-9.152 27.776-17.408 42.56-24.64l35.2-109.312A32 32 0 0 1 423.232 64H600.64zm-23.424 64H446.72l-36.352 113.088-24.512 11.968a294 294 0 0 0-34.816 20.096l-22.656 15.36-116.224-25.088-65.28 113.152 79.68 88.192-1.92 27.136a293 293 0 0 0 0 40.192l1.92 27.136-79.808 88.192 65.344 113.152 116.224-25.024 22.656 15.296a294 294 0 0 0 34.816 20.096l24.512 11.968L446.72 896h130.688l36.48-113.152 24.448-11.904a288 288 0 0 0 34.752-20.096l22.592-15.296 116.288 25.024 65.28-113.152-79.744-88.192 1.92-27.136a293 293 0 0 0 0-40.256l-1.92-27.136 79.808-88.128-65.344-113.152-116.288 24.96-22.592-15.232a288 288 0 0 0-34.752-20.096l-24.448-11.904L577.344 128zM512 320a192 192 0 1 1 0 384 192 192 0 0 1 0-384m0 64a128 128 0 1 0 0 256 128 128 0 0 0 0-256"/>
            </svg>
            <span class="sr-only">Settings</span>
          </button>
          </div>
        </div>

        
      </aside>

      <main class="app-stage">
        <div class="canvas-shell">
          <button class="panel-expand" id="panelExpand" type="button">Expand</button>
          <div class="hint-center" id="hintCenter" aria-label="Hints">
            <button class="hint-icon" id="hintToggle" type="button" aria-label="Toggle hints">?</button>
            <div class="hint-panel" id="hintBody">
              <ul>
                <li>Shift + Drag: link nodes</li>
                <li>Space + Drag: pan</li>
                <li>Wheel: zoom</li>
                <li>Double-click: edit text nodes</li>
                <li>Delete key: delete selected node or edge</li>
              </ul>
            </div>
          </div>

          <canvas id="ew-canvas" aria-label="Elenweave canvas"></canvas>

          <div class="download-overlay" id="downloadOverlay" hidden>
            <div class="download-backdrop" data-download-close="true"></div>
            <div class="download-modal" role="dialog" aria-modal="true" aria-label="Download projects">
              <div class="download-header">
                <div>
                  <div class="download-title">Download</div>
                  <div class="download-sub">Select a project to download.</div>
                </div>
                <button class="btn ghost download-close" id="downloadClose" type="button" aria-label="Close download panel">Close</button>
              </div>
              <div class="download-search">
                <label class="sr-only" for="downloadSearch">Search projects</label>
                <input id="downloadSearch" type="search" placeholder="Search projects" autocomplete="off" />
              </div>
              <div class="download-grid" id="downloadGrid" aria-live="polite"></div>
            </div>
          </div>

          <div class="input-bar" id="inputBar">
            <div class="input-group input-group--component">
              <div class="input-select">
                <select id="componentPicker" aria-label="Component"></select>
              </div>
            </div>
            <div class="input-group input-group--meta" id="metaGroup">
              <div class="input-fields" id="inputFields">
                <div class="node-fields" id="nodeFields"></div>
                <div class="edge-fields" id="edgeFields" aria-hidden="true">
                  <label for="edgeLabelInput">Edge label</label>
                  <div class="edge-row">
                    <input id="edgeLabelInput" type="text" placeholder="Edge label" />
                    <button class="input-btn" id="edgeLabelBtn" type="button">Set</button>
                  </div>
                </div>
              </div>
            </div>
            <div class="input-group input-group--asset" id="assetGroup">
              <div class="asset-fields" id="assetFields"></div>
              <div class="asset-actions">
                <button class="input-btn secondary" id="recordBtn" type="button" title="Record audio">● Record</button>
                <button class="input-btn primary" id="sendBtn" type="button">Add</button>
              </div>
            </div>
          </div>

          <div class="status" id="status">Ready.</div>
        </div>
      </main>
    </div>

    <input type="file" id="importFile" accept="application/json" hidden />
    <div class="modal-backdrop" id="embedModal" role="dialog" aria-modal="true" aria-label="Share board" hidden>
        <div class="modal">
            <div class="modal-header">
                <div>
                    <div class="modal-title">Share Board</div>
                    <div class="modal-sub">Create a public embed link.</div>
                </div>
                <button class="btn ghost modal-close" id="embedClose" type="button">Close</button>
            </div>
            <div class="modal-body">
                <div class="modal-field">
                    <label for="embedThemeSelect">Theme</label>
                    <div class="select-wrap">
                        <select id="embedThemeSelect">
                            <option value="blueprint">Blueprint</option>
                            <option value="light">Light</option>
                            <option value="dark">Dark</option>
                        </select>
                    </div>
                </div>
                <div class="modal-field">
                    <label for="embedLinkInput">Embed Link</label>
                    <div class="embed-link-row">
                        <input id="embedLinkInput" type="text" readonly />
                        <button class="btn" id="embedCopyBtn" type="button">Copy</button>
                    </div>
                    <div class="field-note" id="embedNote">Anyone with the link can view.</div>
                </div>
            </div>
        </div>
    </div>
    <div class="modal-backdrop" id="deleteBoardModal" role="dialog" aria-modal="true" aria-label="Delete board" hidden>
        <div class="modal delete-modal">
            <div class="modal-header">
                <div>
                    <div class="modal-title">Delete Board</div>
                    <div class="modal-sub" id="deleteBoardMessage">Delete this board? This cannot be undone.</div>
                </div>
                <button class="btn ghost modal-close" id="deleteBoardClose" type="button">Close</button>
            </div>
            <div class="modal-actions">
                <button class="btn ghost" id="deleteBoardCancel" type="button">Cancel</button>
                <button class="btn delete-confirm" id="deleteBoardConfirm" type="button">Delete</button>
            </div>
        </div>
    </div>
    <div class="modal-backdrop" id="modelModal" role="dialog" aria-modal="true" aria-label="Model matrix" hidden>
        <div class="modal">
            <div class="modal-header">
                <div>
                    <div class="modal-title">Model Matrix</div>
                    <div class="modal-sub">Choose a provider and store an API key locally.</div>
                </div>
                <button class="btn ghost modal-close" id="modelModalClose" type="button">Close</button>
            </div>
            <div class="modal-body">
                <div class="modal-field">
                    <label for="providerSelect">Provider</label>
                    <div class="select-wrap">
                        <select id="providerSelect">
                            <option value="openai">OpenAI</option>
                            <option value="gemini">Gemini</option>
                        </select>
                    </div>
                </div>
                <div class="modal-field">
                    <label for="apiKeyInput">API Key</label>
                    <input id="apiKeyInput" type="password" placeholder="Paste API key" autocomplete="off" />
                    <div class="field-note" id="apiKeyNote">Stored locally in this browser.</div>
                </div>
                <div class="modal-field">
                    <label for="modelInput">Default Model</label>
                    <input id="modelInput" type="text" placeholder="Model name" autocomplete="off" />
                    <div class="field-note" id="modelNote">Defaults: gpt-5-mini (OpenAI), gemini-3-flash-preview (Gemini).</div>
                </div>
                <div class="modal-actions">
                    <button class="btn ghost" id="apiKeyClear" type="button">Clear Key</button>
                    <button class="btn accent" id="apiKeySave" type="button">Save</button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/elenweave@0.1.2/dist/elenweave.iife.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked@4.3.0/marked.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/dompurify@3.0.8/dist/purify.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10.9.1/dist/mermaid.min.js"></script>
    <script type="module" src="./app.js"></script>
  </body>
</html>
