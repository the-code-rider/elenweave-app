<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Elenweave - Agent Canvas</title>
    <meta name="description" content="Elenweave public demo app for canvas workspaces." />
    <link rel="icon" href="/favicons/favicon.ico" sizes="any" />
    <link rel="icon" type="image/png" sizes="32x32" href="/favicons/favicon-32x32.png" />
    <link rel="icon" type="image/png" sizes="16x16" href="/favicons/favicon-16x16.png" />
    <link rel="apple-touch-icon" sizes="180x180" href="/favicons/apple-touch-icon.png" />
    <link rel="manifest" href="/favicons/site.webmanifest" />

    <script>
      (function () {
        try {
          var saved = localStorage.getItem('elenweave_theme');
          var theme = (saved === 'dark' || saved === 'blueprint') ? saved : 'blueprint';
          document.documentElement.setAttribute('data-theme', theme);
        } catch (err) {
          document.documentElement.setAttribute('data-theme', 'blueprint');
        }
      })();
    </script>
    <script id="elenweave-runtime-config">
      window.__ELENWEAVE_RUNTIME__ = {
        storageMode: 'client'
      };
    </script>

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/elenweave@0.1.1/dist/styles.css" />
    <link rel="stylesheet" href="./app.css" />
  </head>
  <body>
    <div class="app-shell">
      <aside class="app-panel">
        <div class="app-brand-row">
          <a class="app-brand" href="https://elenweave.com" aria-label="Elenweave home">
            <img class="brand-mark" src="/logo.webp" alt="Elenweave logo" />
            <div>
              <h1>Elenweave</h1>
            </div>
          </a>
          <button
            class="btn ghost collapse-btn"
            id="panelToggle"
            type="button"
            aria-label="Collapse sidebar"
            title="Collapse sidebar"
            aria-pressed="false"
          >
            <span class="collapse-icon" aria-hidden="true"></span>
            <span class="sr-only">Toggle sidebar</span>
          </button>
        </div>

        <section class="panel-section panel-section--projects">
          <div class="section-title">Projects</div>
          <div class="project-switcher" aria-label="Project switcher">
            <div class="project-select-wrap">
              <label class="sr-only" for="projectSelect">Project</label>
              <select id="projectSelect" aria-label="Project"></select>
            </div>
            <button class="btn ghost project-rename-btn" id="btnRenameProject" type="button" aria-label="Rename project">
              <svg class="btn-icon" viewBox="0 0 36 36" aria-hidden="true">
                <path d="M33.87 8.32 28 2.42a2.07 2.07 0 0 0-2.92 0L4.27 23.2l-1.9 8.2a2.06 2.06 0 0 0 2 2.5 2 2 0 0 0 .43 0l8.29-1.9 20.78-20.76a2.07 2.07 0 0 0 0-2.92M12.09 30.2l-7.77 1.63 1.77-7.62L21.66 8.7l6 6ZM29 13.25l-6-6 3.48-3.46 5.9 6Z" fill="currentColor"></path>
              </svg>
              <span class="sr-only">Rename project</span>
            </button>
            <button class="btn accent project-add-btn" id="btnNewProject" type="button" aria-label="New project">+</button>
          </div>
        </section>

        <section class="panel-section panel-section--boards">
          <div class="section-title">Boards</div>
          <div class="btn-row board-actions">
            <button class="btn accent board-action-btn" id="btnNew" type="button" aria-label="New board" title="New board">
              <svg class="btn-icon" viewBox="0 0 16 16" aria-hidden="true">
                <path d="M8 3V13"></path>
                <path d="M3 8H13"></path>
              </svg>
              <span class="sr-only">New board</span>
            </button>
            <button class="btn ghost board-action-btn" id="btnSortBoards" type="button" aria-label="Sort boards by time" title="Sort boards by newest updated time">
              <svg class="btn-icon btn-icon-sort" viewBox="0 0 24 24" aria-hidden="true">
                <path d="M6.293 4.293a1 1 0 0 1 1.414 0l4 4a1 1 0 0 1-1.414 1.414L8 7.414V19a1 1 0 1 1-2 0V7.414L3.707 9.707a1 1 0 0 1-1.414-1.414zM16 16.586V5a1 1 0 1 1 2 0v11.586l2.293-2.293a1 1 0 0 1 1.414 1.414l-4 4a1 1 0 0 1-1.414 0l-4-4a1 1 0 0 1 1.414-1.414z" fill="currentColor"></path>
              </svg>
              <span class="sr-only">Sort boards by time</span>
            </button>
            <button class="btn ghost board-action-btn board-action-btn--danger" id="btnDeleteBoard" type="button" aria-label="Delete active board" title="Delete active board">
              <svg class="btn-icon btn-icon-delete" viewBox="0 0 24 24" aria-hidden="true">
                <path d="M4 7H20"></path>
                <path d="M9 7V5.5C9 4.67 9.67 4 10.5 4H13.5C14.33 4 15 4.67 15 5.5V7"></path>
                <path d="M7.5 7L8.3 19.3C8.36 20.18 9.09 20.86 9.98 20.86H14.02C14.91 20.86 15.64 20.18 15.7 19.3L16.5 7"></path>
                <path d="M10 10.5V17"></path>
                <path d="M14 10.5V17"></path>
              </svg>
              <span class="sr-only">Delete active board</span>
            </button>
            <!-- <button class="btn" id="btnPrev" type="button">Prev</button> -->
            <!-- <button class="btn" id="btnNext" type="button">Next</button> -->
          </div>
          <div class="board-list" id="boardList" aria-label="Boards"></div>
        </section>

        <section class="settings-panel" id="settingsPanel" aria-label="Settings panel" hidden>
          <div class="settings-panel__header">
            <div class="section-title">Settings</div>
            <button class="btn ghost settings-close" id="settingsClose" type="button" aria-label="Close settings">Close</button>
          </div>
          <div class="settings-panel__group">
            <div class="section-title">AI</div>
            <div class="btn-row single">
              <button class="btn" id="btnModelMatrix" type="button">AI Model Config</button>
            </div>
            <div class="btn-row single">
              <button class="btn toggle" id="btnRealtime" type="button" aria-pressed="false">Realtime</button>
            </div>
          </div>
          <div class="settings-panel__group">
            <div class="section-title">Tools</div>
            <div class="btn-row single">
              <button class="btn toggle" id="btnLink" type="button" aria-pressed="false">Link Mode</button>
            </div>
            <div class="btn-row single">
              <button class="btn cycle" id="edgeToggle" type="button">Edges: Straight</button>
            </div>
            <div class="btn-row single">
              <button class="btn cycle" id="themeToggle" type="button">Theme</button>
            </div>
            <div class="btn-row">
              <button class="btn" id="btnExport" type="button">Export Board</button>
              <button class="btn ghost" id="btnImport" type="button">Import Board</button>
            </div>
          </div>
          <div class="settings-panel__group desktop-settings" id="desktopSettingsGroup" hidden>
            <div class="section-title">Desktop</div>
            <div class="desktop-runtime" id="desktopRuntimeInfo">Desktop runtime unavailable.</div>
            <label class="desktop-field" for="desktopPortInput">
              <span>Port</span>
              <input id="desktopPortInput" type="number" min="1" max="65535" step="1" placeholder="8787" />
            </label>
            <label class="desktop-field" for="desktopDataDirInput">
              <span>Data Directory</span>
              <input id="desktopDataDirInput" type="text" placeholder="C:\\Users\\you\\.elenweave" />
            </label>
            <label class="desktop-field" for="desktopConfigPathInput">
              <span>Config Path</span>
              <input id="desktopConfigPathInput" type="text" placeholder="C:\\Users\\you\\.elenweave\\config.json" />
            </label>
            <label class="desktop-field" for="desktopAiConfigPathInput">
              <span>AI Config Path</span>
              <input id="desktopAiConfigPathInput" type="text" placeholder="Optional" />
            </label>
            <div class="btn-row">
              <button class="btn" id="desktopSaveConfig" type="button">Save Desktop Config</button>
              <button class="btn ghost" id="desktopRestartServer" type="button">Restart Server</button>
            </div>
            <div class="btn-row">
              <button class="btn ghost" id="desktopOpenDataDir" type="button">Open Data Dir</button>
              <button class="btn ghost" id="desktopOpenConfigFile" type="button">Open Config File</button>
            </div>
          </div>
        </section>

        <div class="panel-footer">
          <button
            class="btn settings-toggle"
            id="settingsToggle"
            type="button"
            aria-expanded="false"
            aria-controls="settingsPanel"
          >
            Settings
          </button>
        </div>

        
      </aside>

      <main class="app-stage">
        <div class="canvas-shell">
          <button class="panel-expand" id="panelExpand" type="button">Expand</button>
          <div class="hint-center" id="hintCenter" aria-label="Hints">
            <button class="hint-icon" id="hintToggle" type="button" aria-label="Toggle hints">?</button>
            <div class="hint-panel" id="hintBody">
              <ul>
                <li>Shift + Drag: link nodes</li>
                <li>Space + Drag: pan</li>
                <li>Wheel: zoom</li>
                <li>Double-click: edit text nodes</li>
                <li>Delete key: delete selected node or edge</li>
              </ul>
            </div>
          </div>

          <canvas id="ew-canvas" aria-label="Elenweave canvas"></canvas>

          <div class="input-bar" id="inputBar">
            <div class="input-group input-group--component">
              <div class="input-select">
                <select id="componentPicker" aria-label="Component"></select>
              </div>
            </div>
            <div class="input-group input-group--meta" id="metaGroup">
              <div class="input-fields" id="inputFields">
                <div class="node-fields" id="nodeFields"></div>
                <div class="edge-fields" id="edgeFields" aria-hidden="true">
                  <label for="edgeLabelInput">Edge label</label>
                  <div class="edge-row">
                    <input id="edgeLabelInput" type="text" placeholder="Edge label" />
                    <button class="input-btn" id="edgeLabelBtn" type="button">Set</button>
                  </div>
                </div>
              </div>
            </div>
            <div class="input-group input-group--asset" id="assetGroup">
              <div class="asset-fields" id="assetFields"></div>
              <div class="asset-actions">
                <button class="input-btn secondary" id="recordBtn" type="button" title="Record audio">● Record</button>
                <button class="input-btn primary" id="sendBtn" type="button">Add</button>
              </div>
            </div>
          </div>

          <div class="status" id="status">Ready.</div>
        </div>
      </main>
    </div>

    <input type="file" id="importFile" accept="application/json" hidden />
    <div class="modal-backdrop" id="modelModal" role="dialog" aria-modal="true" aria-label="Model matrix" hidden>
        <div class="modal">
            <div class="modal-header">
                <div>
                    <div class="modal-title">Model Matrix</div>
                    <div class="modal-sub">Choose a provider and store an API key locally.</div>
                </div>
                <button class="btn ghost modal-close" id="modelModalClose" type="button">Close</button>
            </div>
            <div class="modal-body">
                <div class="modal-field">
                    <label for="providerSelect">Provider</label>
                    <div class="select-wrap">
                        <select id="providerSelect">
                            <option value="openai">OpenAI</option>
                            <option value="gemini">Gemini</option>
                        </select>
                    </div>
                </div>
                <div class="modal-field">
                    <label for="apiKeyInput">API Key</label>
                    <input id="apiKeyInput" type="password" placeholder="Paste API key" autocomplete="off" />
                    <div class="field-note" id="apiKeyNote">Stored locally in this browser.</div>
                </div>
                <div class="modal-field">
                    <label for="modelInput">Default Model</label>
                    <input id="modelInput" type="text" placeholder="Model name" autocomplete="off" />
                    <div class="field-note" id="modelNote">Defaults: gpt-5-mini (OpenAI), gemini-3-flash-preview (Gemini).</div>
                </div>
                <div class="modal-actions">
                    <button class="btn ghost" id="apiKeyClear" type="button">Clear Key</button>
                    <button class="btn accent" id="apiKeySave" type="button">Save</button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/elenweave@0.1.2/dist/elenweave.iife.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked@4.3.0/marked.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/dompurify@3.0.8/dist/purify.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10.9.1/dist/mermaid.min.js"></script>
    <script type="module" src="./app.js"></script>
  </body>
</html>
