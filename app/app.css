:root {
    color-scheme: dark;
    --app-bg: radial-gradient(1100px 560px at 12% 10%, rgba(111, 211, 167, 0.18) 0%, transparent 60%),
        radial-gradient(900px 520px at 82% 16%, rgba(242, 184, 75, 0.11) 0%, transparent 58%),
        linear-gradient(160deg, #0b1117 0%, #0f1419 58%, #131a22 100%);
    --app-panel: rgba(22, 28, 35, 0.94);
    --app-border: rgba(46, 55, 66, 0.82);
    --app-text: #e8edf3;
    --app-muted: rgba(154, 166, 178, 0.9);
    --app-accent: #6fd3a7;
    --app-accent-2: #42b883;
    --app-warning: #f2b84b;
    --app-input: rgba(18, 24, 31, 0.9);
    --app-shadow: 0 24px 48px rgba(0, 0, 0, 0.45);

    --bg-0: #0b1117;
    --bg-1: #0f1419;
    --bg-2: #131a22;
    --cyan: var(--app-accent);
    --mint: var(--app-accent-2);
    --amber: var(--app-warning);
    --text: var(--app-text);
    --muted: var(--app-muted);
    --panel: var(--app-panel);
    --panel-border: var(--app-border);
}

html[data-theme="light"] {
    color-scheme: light;
    --app-bg: radial-gradient(1200px 600px at 12% 8%, rgba(111, 211, 167, 0.2) 0%, transparent 58%),
        radial-gradient(900px 520px at 84% 12%, rgba(242, 184, 75, 0.12) 0%, transparent 55%),
        linear-gradient(160deg, #f5f6f8 0%, #eef1f4 55%, #e8edf2 100%);
    --app-panel: rgba(255, 255, 255, 0.94);
    --app-border: rgba(213, 220, 229, 0.95);
    --app-text: #11161c;
    --app-muted: rgba(94, 107, 120, 0.88);
    --app-accent: #2f9d72;
    --app-accent-2: #6fd3a7;
    --app-warning: #c1842a;
    --app-input: rgba(255, 255, 255, 0.96);
    --app-shadow: 0 18px 34px rgba(20, 30, 40, 0.12);

    --bg-0: #f5f6f8;
    --bg-1: #eef1f4;
    --bg-2: #e8edf2;
    --cyan: var(--app-accent);
    --mint: var(--app-accent-2);
    --amber: var(--app-warning);
    --text: var(--app-text);
    --muted: var(--app-muted);
    --panel: var(--app-panel);
    --panel-border: var(--app-border);
}

html[data-theme="blueprint"] {
    color-scheme: dark;
    --app-bg: radial-gradient(1200px 640px at 18% 12%, rgba(111, 211, 167, 0.16) 0%, transparent 62%),
        radial-gradient(900px 520px at 80% 18%, rgba(107, 145, 184, 0.18) 0%, transparent 56%),
        linear-gradient(160deg, #101923 0%, #15212f 55%, #1a2938 100%);
    --app-panel: rgba(20, 31, 44, 0.94);
    --app-border: rgba(47, 67, 88, 0.88);
    --app-text: #e8edf3;
    --app-muted: rgba(167, 183, 201, 0.84);
    --app-accent: #6fd3a7;
    --app-accent-2: #42b883;
    --app-warning: #f2b84b;
    --app-input: rgba(22, 35, 50, 0.9);
    --app-shadow: 0 24px 48px rgba(0, 0, 0, 0.5);

    --bg-0: #101923;
    --bg-1: #15212f;
    --bg-2: #1a2938;
    --cyan: var(--app-accent);
    --mint: var(--app-accent-2);
    --amber: var(--app-warning);
    --text: var(--app-text);
    --muted: var(--app-muted);
    --panel: var(--app-panel);
    --panel-border: var(--app-border);
}

html,
body {
    height: 100%;
    overflow: hidden;
    margin: 0;
}

body {
    background: var(--app-bg);
    color: var(--app-text);
}

.app-shell {
    display: grid;
    --panel-width: 320px;
    grid-template-columns: var(--panel-width) 1fr;
    min-height: 100vh;
    height: 100vh;
}

.app-shell.is-collapsed {
    --panel-width: 0px;
}

.app-panel {
    background: var(--app-panel);
    border-right: 1px solid var(--app-border);
    padding: 22px 18px 28px;
    display: flex;
    flex-direction: column;
    gap: 18px;
    max-height: 100vh;
    overflow: auto;
    box-shadow: var(--app-shadow);
    position: relative;
}

.app-shell.is-collapsed .app-panel {
    width: 0;
    padding: 0;
    border: none;
    overflow: hidden;
    box-shadow: none;
}

.app-brand-row {
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 10px;
}

.app-brand {
    display: flex;
    align-items: center;
    gap: 12px;
    color: inherit;
    text-decoration: none;
    min-width: 0;
    flex: 1 1 auto;
}

.brand-mark {
    width: 40px;
    height: 40px;
    border-radius: 12px;
    border: 1px solid var(--app-border);
    background: #ffffff;
    box-shadow: inset 0 0 12px color-mix(in oklab, var(--app-accent) 36%, transparent);
    object-fit: cover;
}

.app-brand h1 {
    margin: 0;
    font-size: 1.1rem;
    letter-spacing: 0.04em;
    text-transform: uppercase;
    color: var(--app-accent);
}

.app-brand p {
    margin: 0;
    font-size: 0.75rem;
    letter-spacing: 0.2em;
    text-transform: uppercase;
    color: var(--app-muted);
}

.panel-tools {
    display: flex;
    justify-content: flex-start;
    gap: 8px;
    flex-wrap: wrap;
}

.collapse-btn {
    min-width: 34px;
    width: 34px;
    height: 34px;
    padding: 0;
    display: grid;
    place-items: center;
    flex: 0 0 auto;
}

.collapse-icon {
    width: 10px;
    height: 10px;
    border-top: 2px solid currentColor;
    border-right: 2px solid currentColor;
    transform: rotate(-135deg);
    transition: transform 120ms ease;
}

.app-shell.is-collapsed .collapse-icon {
    transform: rotate(45deg);
}

.panel-section {
    display: grid;
    /* gap: 10px; */
}

.panel-section--boards {
    flex: 1 1 auto;
    min-height: 0;
    display: flex;
    flex-direction: column;
    gap: 12px;
}

.panel-section--boards .btn-row {
    position: sticky;
    top: 0;
    z-index: 3;
    padding-top: 2px;
    background: linear-gradient(
        180deg,
        color-mix(in oklab, var(--app-panel) 96%, transparent),
        color-mix(in oklab, var(--app-panel) 84%, transparent)
    );
    backdrop-filter: blur(1px);
}

.panel-section--projects {
    display: flex;
    flex-direction: column;
    gap: 8px;
}

.project-switcher {
    display: flex;
    align-items: center;
    gap: 8px;
}

.project-select-wrap {
    position: relative;
    flex: 1 1 auto;
}

.project-select-wrap::after {
    content: '';
    position: absolute;
    right: 12px;
    top: 50%;
    width: 7px;
    height: 7px;
    border-right: 2px solid var(--app-muted);
    border-bottom: 2px solid var(--app-muted);
    transform: translateY(-58%) rotate(45deg);
    pointer-events: none;
}

.project-select-wrap.is-editing::after {
    display: none;
}

.project-select-wrap.is-editing #projectSelect {
    display: none;
}

#projectSelect {
    width: 100%;
    appearance: none;
    border-radius: 10px;
    border: 1px solid color-mix(in oklab, var(--app-border) 70%, rgba(255, 255, 255, 0.12));
    background: linear-gradient(
        180deg,
        color-mix(in oklab, var(--app-panel) 72%, #ffffff 28%),
        color-mix(in oklab, var(--app-panel) 82%, #ffffff 18%)
    );
    color: var(--app-text);
    min-height: 34px;
    padding: 6px 30px 6px 10px;
    font-size: 0.72rem;
    letter-spacing: 0.08em;
    text-transform: uppercase;
}

#projectSelect:focus {
    outline: 2px solid color-mix(in oklab, var(--app-accent) 65%, transparent);
    outline-offset: 1px;
}

#projectSelect option {
    background: #15202c;
    color: #e8edf3;
}

html[data-theme="light"] #projectSelect option {
    background: #ffffff;
    color: #11161c;
}

.project-rename-input {
    width: 100%;
    appearance: none;
    border-radius: 10px;
    border: 1px solid color-mix(in oklab, var(--app-border) 70%, rgba(255, 255, 255, 0.12));
    background: linear-gradient(
        180deg,
        color-mix(in oklab, var(--app-panel) 72%, #ffffff 28%),
        color-mix(in oklab, var(--app-panel) 82%, #ffffff 18%)
    );
    color: var(--app-text);
    min-height: 34px;
    padding: 6px 10px;
    font-size: 0.72rem;
    letter-spacing: 0.02em;
    text-transform: none;
}

.project-rename-input:focus {
    outline: 2px solid color-mix(in oklab, var(--app-accent) 65%, transparent);
    outline-offset: 1px;
}

.project-add-btn {
    min-width: 34px;
    width: 34px;
    height: 34px;
    padding: 0;
    display: grid;
    place-items: center;
    font-size: 1.05rem;
    line-height: 1;
}

.project-rename-btn {
    min-width: 34px;
    width: 34px;
    height: 34px;
    padding: 0;
    display: grid;
    place-items: center;
}

.project-rename-btn .btn-icon {
    width: 14px;
    height: 14px;
    fill: currentColor;
    stroke: none;
}

.panel-section--boards .btn {
    padding: 6px 10px;
    font-size: 0.72rem;
    letter-spacing: 0.08em;
}

.board-actions {
    display: flex;
    align-items: center;
    gap: 8px;
}

.board-action-btn {
    min-width: 34px;
    width: 34px;
    height: 34px;
    padding: 0;
    display: grid;
    place-items: center;
}

.board-action-btn .btn-icon {
    width: 14px;
    height: 14px;
    fill: none;
    stroke: currentColor;
    stroke-width: 1.9;
    stroke-linecap: round;
    stroke-linejoin: round;
}

.board-action-btn .btn-icon-delete {
    fill: currentColor;
    stroke: none;
}

#btnSortBoards .btn-icon-sort {
    fill: currentColor;
    stroke: none;
    transition: transform 120ms ease;
}

#btnSortBoards[data-order="asc"] .btn-icon-sort {
    transform: rotate(180deg);
}

#btnDeleteBoard {
    color: color-mix(in oklab, var(--app-warning) 78%, var(--app-text) 22%);
    border-color: color-mix(in oklab, var(--app-warning) 42%, var(--app-border));
}

#btnDeleteBoard:hover:not(:disabled) {
    background: linear-gradient(
        180deg,
        color-mix(in oklab, var(--app-warning) 18%, var(--app-panel)),
        color-mix(in oklab, var(--app-warning) 10%, var(--app-panel))
    );
    border-color: color-mix(in oklab, var(--app-warning) 58%, var(--app-border));
}

#btnDeleteBoard:disabled {
    opacity: 0.42;
    cursor: not-allowed;
}

html[data-theme="light"] #btnDeleteBoard {
    color: color-mix(in oklab, #7d4a0f 86%, var(--app-text) 14%);
    border-color: color-mix(in oklab, #c1842a 44%, var(--app-border));
}

html[data-theme="light"] #btnDeleteBoard:hover:not(:disabled) {
    background: linear-gradient(
        180deg,
        color-mix(in oklab, #f6d9a7 52%, #ffffff 48%),
        color-mix(in oklab, #eac180 62%, #ffffff 38%)
    );
}

.panel-section--tools {
    margin-top: auto;
    display: grid;
    gap: 8px;
}

.settings-panel {
    position: absolute;
    bottom: 62px;
    left: 12px;
    right: 12px;
    z-index: 18;
    border-radius: 14px;
    border: 1px solid color-mix(in oklab, var(--app-border) 78%, rgba(255, 255, 255, 0.08));
    background: color-mix(in oklab, var(--app-panel) 94%, rgba(0, 0, 0, 0.06));
    box-shadow:
        inset 0 1px 0 rgba(255, 255, 255, 0.14),
        inset 0 -1px 0 rgba(0, 0, 0, 0.36),
        0 16px 28px rgba(0, 0, 0, 0.35);
    padding: 10px;
    max-height: min(58vh, calc(100% - 120px));
    overflow: auto;
}

.settings-panel[hidden] {
    display: none;
}

.settings-panel__header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 10px;
    margin-bottom: 10px;
}

.settings-close {
    min-height: 30px;
    padding: 4px 10px;
    font-size: 0.66rem;
    letter-spacing: 0.08em;
}

.settings-panel__group {
    display: grid;
    gap: 6px;
    margin-bottom: 10px;
}

.settings-panel__group:last-child {
    margin-bottom: 0;
}

.desktop-settings[hidden] {
    display: none;
}

.desktop-runtime {
    font-size: 0.62rem;
    line-height: 1.45;
    color: var(--app-muted);
    border: 1px solid color-mix(in oklab, var(--app-border) 70%, transparent);
    border-radius: 10px;
    padding: 8px 9px;
    background: color-mix(in oklab, var(--app-panel) 84%, transparent);
    margin-bottom: 2px;
}

.desktop-field {
    display: grid;
    gap: 4px;
    font-size: 0.58rem;
    letter-spacing: 0.08em;
    text-transform: uppercase;
    color: var(--app-muted);
}

.desktop-field input {
    min-height: 30px;
    border-radius: 8px;
    border: 1px solid color-mix(in oklab, var(--app-border) 70%, rgba(255, 255, 255, 0.12));
    background: color-mix(in oklab, var(--app-panel) 78%, rgba(0, 0, 0, 0.08));
    color: var(--app-text);
    padding: 6px 9px;
    font-size: 0.68rem;
    letter-spacing: 0.02em;
}

.desktop-field input:focus {
    outline: 2px solid color-mix(in oklab, var(--app-accent) 60%, transparent);
    outline-offset: 1px;
}

html[data-theme="light"] .desktop-runtime {
    background: color-mix(in oklab, #ffffff 88%, var(--app-panel) 12%);
    border-color: color-mix(in oklab, var(--app-border) 62%, rgba(255, 255, 255, 0.8));
}

html[data-theme="light"] .desktop-field input {
    background: color-mix(in oklab, #ffffff 90%, var(--app-panel) 10%);
    border-color: color-mix(in oklab, var(--app-border) 58%, rgba(255, 255, 255, 0.82));
}

.panel-footer {
    margin-top: auto;
    position: sticky;
    bottom: 0;
    z-index: 5;
    padding-top: 8px;
    background: linear-gradient(
        180deg,
        color-mix(in oklab, var(--app-panel) 70%, transparent),
        color-mix(in oklab, var(--app-panel) 95%, transparent)
    );
}

.panel-footer-actions {
    display: flex;
    align-items: stretch;
    gap: 8px;
}

.panel-footer .settings-toggle {
    flex: 1 1 0;
    width: auto;
    border-color: color-mix(in oklab, var(--app-accent) 45%, var(--app-border));
    background: linear-gradient(
        180deg,
        color-mix(in oklab, var(--app-accent) 32%, var(--app-panel)),
        color-mix(in oklab, var(--app-accent) 24%, var(--app-panel)) 52%,
        color-mix(in oklab, var(--app-accent) 18%, var(--app-panel))
    );
    color: var(--app-text);
    box-shadow:
        inset 0 1px 0 rgba(255, 255, 255, 0.2),
        inset 0 -1px 0 rgba(0, 0, 0, 0.38),
        0 8px 14px rgba(0, 0, 0, 0.26);
}

.panel-footer .settings-toggle:hover {
    border-color: color-mix(in oklab, var(--app-accent) 60%, var(--app-border));
    background: linear-gradient(
        180deg,
        color-mix(in oklab, var(--app-accent) 38%, var(--app-panel)),
        color-mix(in oklab, var(--app-accent) 28%, var(--app-panel)) 52%,
        color-mix(in oklab, var(--app-accent) 22%, var(--app-panel))
    );
}

.panel-footer .settings-toggle {
    display: grid;
    place-items: center;
    padding-left: 10px;
    padding-right: 10px;
}

.panel-footer .footer-download {
    flex: 1 1 0;
    width: auto;
    min-width: 0;
    padding: 0;
    display: grid;
    place-items: center;
    border-color: color-mix(in oklab, var(--app-accent) 34%, var(--app-border));
    background: color-mix(in oklab, var(--app-panel) 88%, transparent);
    color: var(--app-text);
}

.panel-footer .footer-download:hover {
    border-color: color-mix(in oklab, var(--app-accent) 58%, var(--app-border));
}

.settings-toggle-icon {
    width: 18px;
    height: 18px;
    display: block;
    fill: currentColor;
}

.footer-download-icon {
    width: 18px;
    height: 18px;
    display: block;
    fill: currentColor;
}

.settings-panel .btn {
    padding: 6px 10px;
    font-size: 0.72rem;
    letter-spacing: 0.08em;
    border: 1px solid color-mix(in oklab, var(--app-border) 70%, rgba(255, 255, 255, 0.12));
    background: transparent;
    box-shadow:
        inset 0 2px 0 rgba(255, 255, 255, 0.18),
        inset 0 -2px 0 rgba(0, 0, 0, 0.4),
        0 10px 16px rgba(0, 0, 0, 0.26);
}

.settings-panel .btn:hover {
    background: linear-gradient(
        180deg,
        color-mix(in oklab, var(--app-panel) 78%, rgba(255, 255, 255, 0.08)),
        color-mix(in oklab, var(--app-panel) 92%, rgba(0, 0, 0, 0.18))
    );
    box-shadow:
        inset 0 2px 0 rgba(255, 255, 255, 0.2),
        inset 0 -2px 0 rgba(0, 0, 0, 0.4),
        0 12px 18px rgba(0, 0, 0, 0.32);
}

.settings-panel .btn:active {
    transform: translateY(1px);
    box-shadow:
        inset 0 2px 3px rgba(0, 0, 0, 0.35),
        inset 0 -1px 0 rgba(255, 255, 255, 0.08);
}

.settings-panel .btn.toggle {
    --toggle-track-w: 30px;
    --toggle-track-h: 18px;
    --toggle-knob: 12px;
    --toggle-right: 10px;
    --toggle-offset: 2px;
    position: relative;
    text-align: left;
    min-height: 42px;
    line-height: 1.1;
    padding-right: 52px;
    padding-top: 9px;
    padding-bottom: 9px;
}

.settings-panel .btn.toggle::before {
    content: '';
    position: absolute;
    right: var(--toggle-right);
    top: 50%;
    width: var(--toggle-track-w);
    height: var(--toggle-track-h);
    transform: translateY(-50%);
    border-radius: 999px;
    border: 1px solid color-mix(in oklab, var(--app-border) 76%, transparent);
    background: linear-gradient(
        180deg,
        color-mix(in oklab, var(--app-panel) 82%, rgba(255, 255, 255, 0.06)),
        color-mix(in oklab, var(--app-panel) 72%, rgba(0, 0, 0, 0.28))
    );
    box-shadow:
        inset 0 1px 0 rgba(255, 255, 255, 0.18),
        inset 0 -1px 0 rgba(0, 0, 0, 0.38),
        0 1px 4px rgba(0, 0, 0, 0.34);
    transition: background 120ms ease, border-color 120ms ease, box-shadow 120ms ease;
}

.settings-panel .btn.toggle::after {
    content: '';
    position: absolute;
    right: calc(var(--toggle-right) + var(--toggle-track-w) - var(--toggle-knob) - var(--toggle-offset));
    top: 50%;
    width: var(--toggle-knob);
    height: var(--toggle-knob);
    transform: translateY(-50%);
    border-radius: 999px;
    background: linear-gradient(
        180deg,
        color-mix(in oklab, #ffffff 68%, var(--app-muted) 32%),
        color-mix(in oklab, var(--app-muted) 76%, #111 24%)
    );
    box-shadow:
        inset 0 1px 0 rgba(255, 255, 255, 0.45),
        inset 0 -1px 0 rgba(0, 0, 0, 0.32),
        0 2px 5px rgba(0, 0, 0, 0.4);
    transition: transform 120ms ease, background 120ms ease, box-shadow 120ms ease;
}

.settings-panel .btn.toggle[aria-pressed="true"]::before {
    border-color: color-mix(in oklab, var(--app-accent) 62%, var(--app-border));
    background: linear-gradient(
        180deg,
        color-mix(in oklab, var(--app-accent) 44%, var(--app-panel)),
        color-mix(in oklab, var(--app-accent) 24%, var(--app-panel))
    );
    box-shadow:
        inset 0 1px 0 color-mix(in oklab, #ffffff 28%, var(--app-accent) 72%),
        inset 0 -1px 0 rgba(0, 0, 0, 0.26),
        0 1px 6px color-mix(in oklab, var(--app-accent) 34%, transparent);
}

.settings-panel .btn.toggle[aria-pressed="true"]::after {
    transform: translate(calc(var(--toggle-track-w) - var(--toggle-knob) - (var(--toggle-offset) * 2)), -50%);
    background: linear-gradient(
        180deg,
        color-mix(in oklab, #ffffff 36%, var(--app-accent) 64%),
        color-mix(in oklab, var(--app-accent) 88%, #0a1712 12%)
    );
    box-shadow:
        inset 0 1px 0 rgba(255, 255, 255, 0.36),
        inset 0 -1px 0 rgba(0, 0, 0, 0.2),
        0 2px 6px color-mix(in oklab, var(--app-accent) 42%, transparent);
}

.settings-panel .btn.cycle {
    position: relative;
    text-align: left;
    padding-right: 34px;
}

.settings-panel .btn.cycle::before,
.settings-panel .btn.cycle::after {
    content: '';
    position: absolute;
    top: 50%;
    width: 0;
    height: 0;
    border-top: 4px solid transparent;
    border-bottom: 4px solid transparent;
    border-left: 5px solid color-mix(in oklab, var(--app-muted) 78%, var(--app-text) 22%);
    transform: translateY(-50%);
    transition: transform 120ms ease, border-left-color 120ms ease;
}

.settings-panel .btn.cycle::before {
    right: 16px;
}

.settings-panel .btn.cycle::after {
    right: 9px;
}

.settings-panel .btn.cycle:hover::before,
.settings-panel .btn.cycle:hover::after {
    border-left-color: color-mix(in oklab, var(--app-accent) 62%, var(--app-text) 38%);
}

.settings-panel .btn.cycle:hover::before {
    transform: translate(1px, -50%);
}

.settings-panel .btn.cycle:hover::after {
    transform: translate(2px, -50%);
}

html[data-theme="light"] .settings-panel {
    border-color: color-mix(in oklab, var(--app-border) 68%, rgba(255, 255, 255, 0.82));
    background: color-mix(in oklab, var(--app-panel) 96%, rgba(255, 255, 255, 0.66));
    box-shadow:
        inset 0 1px 0 rgba(255, 255, 255, 0.94),
        inset 0 -1px 0 rgba(18, 24, 38, 0.14),
        0 12px 20px rgba(18, 24, 38, 0.16);
}

html[data-theme="light"] .settings-panel .btn {
    border-color: color-mix(in oklab, var(--app-border) 60%, rgba(255, 255, 255, 0.75));
    box-shadow:
        inset 0 2px 0 rgba(255, 255, 255, 0.95),
        inset 0 -2px 0 rgba(18, 24, 38, 0.16),
        0 8px 14px rgba(18, 24, 38, 0.12);
}

html[data-theme="light"] .settings-panel .btn:hover {
    background: linear-gradient(
        180deg,
        rgba(255, 255, 255, 0.94),
        rgba(234, 240, 248, 0.94)
    );
}

html[data-theme="light"] .settings-panel .btn.toggle::before {
    background: linear-gradient(
        180deg,
        color-mix(in oklab, #ffffff 86%, #dfe7f0 14%),
        color-mix(in oklab, #e2e9f2 78%, #c7d3e2 22%)
    );
    border-color: color-mix(in oklab, var(--app-border) 70%, rgba(18, 24, 38, 0.1));
    box-shadow:
        inset 0 1px 0 rgba(255, 255, 255, 0.96),
        inset 0 -1px 0 rgba(18, 24, 38, 0.16),
        0 1px 3px rgba(18, 24, 38, 0.18);
}

html[data-theme="light"] .settings-panel .btn.toggle::after {
    background: linear-gradient(
        180deg,
        #ffffff,
        color-mix(in oklab, #b2becf 74%, #ffffff 26%)
    );
    box-shadow:
        inset 0 1px 0 rgba(255, 255, 255, 0.95),
        inset 0 -1px 0 rgba(18, 24, 38, 0.12),
        0 2px 4px rgba(18, 24, 38, 0.2);
}

html[data-theme="light"] .settings-panel .btn.toggle[aria-pressed="true"]::before {
    background: linear-gradient(
        180deg,
        color-mix(in oklab, var(--app-accent) 30%, #f2faf6 70%),
        color-mix(in oklab, var(--app-accent) 42%, #dff2e8 58%)
    );
    border-color: color-mix(in oklab, var(--app-accent) 62%, #b7d8c8 38%);
    box-shadow:
        inset 0 1px 0 rgba(255, 255, 255, 0.85),
        inset 0 -1px 0 rgba(18, 24, 38, 0.08),
        0 1px 5px color-mix(in oklab, var(--app-accent) 28%, transparent);
}

html[data-theme="light"] .settings-panel .btn.toggle[aria-pressed="true"]::after {
    background: linear-gradient(
        180deg,
        color-mix(in oklab, #ffffff 34%, var(--app-accent) 66%),
        color-mix(in oklab, var(--app-accent) 76%, #1f6b4e 24%)
    );
    box-shadow:
        inset 0 1px 0 rgba(255, 255, 255, 0.8),
        inset 0 -1px 0 rgba(18, 24, 38, 0.12),
        0 2px 5px color-mix(in oklab, var(--app-accent) 36%, transparent);
}

.settings-panel .btn-row.single {
    min-height: 44px;
}

html[data-theme="light"] .settings-panel .btn.cycle::before,
html[data-theme="light"] .settings-panel .btn.cycle::after {
    border-left-color: color-mix(in oklab, var(--app-muted) 74%, #304251 26%);
}

html[data-theme="light"] .panel-footer .settings-toggle {
    background: linear-gradient(
        180deg,
        color-mix(in oklab, var(--app-accent) 86%, #ffffff 14%),
        color-mix(in oklab, var(--app-accent) 94%, #ffffff 6%) 56%,
        color-mix(in oklab, var(--app-accent) 82%, #1e6248 18%)
    );
    border-color: color-mix(in oklab, var(--app-accent) 82%, rgba(0, 0, 0, 0.08));
    color: #ffffff;
    box-shadow:
        inset 0 1px 0 rgba(255, 255, 255, 0.28),
        inset 0 -1px 0 rgba(0, 0, 0, 0.14),
        0 8px 14px color-mix(in oklab, var(--app-accent) 26%, transparent);
}

html[data-theme="light"] .panel-footer .settings-toggle:hover {
    background: color-mix(in oklab, var(--app-accent) 88%, #ffffff 12%);
}

html[data-theme="light"] .panel-footer .footer-download {
    background: rgba(255, 255, 255, 0.9);
    border-color: color-mix(in oklab, var(--app-border) 58%, rgba(255, 255, 255, 0.8));
    color: var(--app-text);
    box-shadow:
        inset 0 1px 0 rgba(255, 255, 255, 0.85),
        inset 0 -1px 0 rgba(18, 24, 38, 0.12),
        0 10px 16px rgba(18, 24, 38, 0.12);
}

html[data-theme="light"] .panel-footer .footer-download:hover {
    border-color: color-mix(in oklab, var(--app-accent) 45%, var(--app-border));
}

.panel-section--tools .tools-body[hidden] {
    display: none;
}

.panel-section--tools .tools-toggle {
    width: 100%;
}

.panel-section--tools .btn-row {
    margin-bottom: 6px;
}

.panel-section--tools .btn {
    padding: 6px 10px;
    font-size: 0.72rem;
    letter-spacing: 0.08em;
    border: 1px solid color-mix(in oklab, var(--app-border) 70%, rgba(255, 255, 255, 0.12));
    background: transparent;
    box-shadow:
        inset 0 2px 0 rgba(255, 255, 255, 0.18),
        inset 0 -2px 0 rgba(0, 0, 0, 0.4),
        0 10px 16px rgba(0, 0, 0, 0.26);
}

.panel-section--ai .btn {
    padding: 6px 10px;
    font-size: 0.72rem;
    letter-spacing: 0.08em;
    border: 1px solid color-mix(in oklab, var(--app-border) 70%, rgba(255, 255, 255, 0.12));
    background: transparent;
    box-shadow:
        inset 0 2px 0 rgba(255, 255, 255, 0.18),
        inset 0 -2px 0 rgba(0, 0, 0, 0.4),
        0 10px 16px rgba(0, 0, 0, 0.26);
}

.panel-section--tools .btn:hover,
.panel-section--ai .btn:hover {
    background: linear-gradient(
        180deg,
        color-mix(in oklab, var(--app-panel) 78%, rgba(255, 255, 255, 0.08)),
        color-mix(in oklab, var(--app-panel) 92%, rgba(0, 0, 0, 0.18))
    );
    box-shadow:
        inset 0 2px 0 rgba(255, 255, 255, 0.2),
        inset 0 -2px 0 rgba(0, 0, 0, 0.4),
        0 12px 18px rgba(0, 0, 0, 0.32);
}

.panel-section--tools .btn:active,
.panel-section--ai .btn:active {
    transform: translateY(1px);
    box-shadow:
        inset 0 2px 3px rgba(0, 0, 0, 0.35),
        inset 0 -1px 0 rgba(255, 255, 255, 0.08);
}

html[data-theme="light"] .panel-section--tools .btn,
html[data-theme="light"] .panel-section--ai .btn {
    border-color: color-mix(in oklab, var(--app-border) 60%, rgba(255, 255, 255, 0.75));
    background: transparent;
    box-shadow:
        inset 0 2px 0 rgba(255, 255, 255, 0.95),
        inset 0 -2px 0 rgba(18, 24, 38, 0.16),
        0 8px 14px rgba(18, 24, 38, 0.12);
}

html[data-theme="light"] .panel-section--tools .btn:hover,
html[data-theme="light"] .panel-section--ai .btn:hover {
    background: linear-gradient(
        180deg,
        rgba(255, 255, 255, 0.94),
        rgba(234, 240, 248, 0.94)
    );
}

.btn-row{
    margin-bottom: 10px;
}

button#btnModelMatrix {
    border: 2px solid gold;
}
.section-title {
    color: var(--app-muted);
}

.panel-section .section-title {
    font-size: 0.6rem;
}

.field input {
    background: var(--app-input);
}

.sr-only {
    position: absolute;
    width: 1px;
    height: 1px;
    padding: 0;
    margin: -1px;
    overflow: hidden;
    clip: rect(0, 0, 0, 0);
    white-space: nowrap;
    border: 0;
}

.helper-text {
    font-size: 0.75rem;
    color: var(--app-muted);
    line-height: 1.4;
}

/* Node border is visible only when selected. */
[data-ew-node-id],
[data-ew-node-id] .ew-node-shell {
    border-color: transparent !important;
    box-shadow: none !important;
}

[data-ew-node-id].ew-node-selected,
[data-ew-node-id].ew-node-selected .ew-node-shell {
    border-color: color-mix(in oklab, var(--app-accent) 72%, var(--app-border)) !important;
    box-shadow:
        0 0 0 1px color-mix(in oklab, var(--app-accent) 34%, transparent),
        0 0 14px color-mix(in oklab, var(--app-accent) 18%, transparent) !important;
}

.ew-node-context-menu {
    position: fixed;
    z-index: 40;
    min-width: 132px;
    display: grid;
    gap: 4px;
    padding: 6px;
    border-radius: 10px;
    border: 1px solid color-mix(in oklab, var(--app-border) 78%, rgba(255, 255, 255, 0.08));
    background: color-mix(in oklab, var(--app-panel) 94%, transparent);
    box-shadow:
        inset 0 1px 0 rgba(255, 255, 255, 0.14),
        inset 0 -1px 0 rgba(0, 0, 0, 0.35),
        0 12px 22px rgba(0, 0, 0, 0.34);
}

.ew-node-context-menu.is-hidden {
    display: none;
}

.ew-node-context-menu__item {
    border: 1px solid color-mix(in oklab, var(--app-border) 75%, transparent);
    background: linear-gradient(
        180deg,
        color-mix(in oklab, var(--app-panel) 78%, rgba(255, 255, 255, 0.08)),
        color-mix(in oklab, var(--app-panel) 90%, rgba(0, 0, 0, 0.18))
    );
    color: var(--app-text);
    border-radius: 8px;
    min-height: 28px;
    padding: 0 10px;
    text-align: left;
    font-size: 0.68rem;
    letter-spacing: 0.08em;
    text-transform: uppercase;
    cursor: pointer;
}

.ew-node-context-menu__item:hover {
    border-color: color-mix(in oklab, var(--app-accent) 60%, var(--app-border));
}

.ew-node-context-menu__item:active {
    transform: translateY(1px);
}

.ew-node-context-menu__item:focus-visible {
    outline: 2px solid color-mix(in oklab, var(--app-accent) 65%, transparent);
    outline-offset: 1px;
}

html[data-theme="light"] .ew-node-context-menu {
    border-color: color-mix(in oklab, var(--app-border) 68%, rgba(255, 255, 255, 0.85));
    box-shadow:
        inset 0 1px 0 rgba(255, 255, 255, 0.9),
        inset 0 -1px 0 rgba(18, 24, 38, 0.14),
        0 10px 18px rgba(18, 24, 38, 0.14);
}

html[data-theme="light"] .ew-node-context-menu__item {
    background: linear-gradient(
        180deg,
        rgba(255, 255, 255, 0.95),
        rgba(236, 241, 248, 0.94)
    );
}

.modal-backdrop {
    position: fixed;
    inset: 0;
    background: rgba(2, 8, 16, 0.7);
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 24px;
    z-index: 20;
}

html[data-theme="light"] .modal-backdrop {
    background: rgba(8, 16, 26, 0.4);
}

.modal-backdrop[hidden] {
    display: none;
}

.modal {
    width: min(520px, 100%);
    border-radius: 18px;
    border: 1px solid var(--app-border);
    background: color-mix(in oklab, var(--app-panel) 92%, transparent);
    box-shadow: var(--app-shadow);
    padding: 18px;
    display: grid;
    gap: 16px;
}

.modal-header {
    display: flex;
    align-items: flex-start;
    justify-content: space-between;
    gap: 12px;
}

.modal-title {
    font-size: 1rem;
    letter-spacing: 0.08em;
    text-transform: uppercase;
    color: var(--app-accent);
}

.modal-sub {
    margin-top: 6px;
    font-size: 0.75rem;
    color: var(--app-muted);
}

.modal-body {
    display: grid;
    gap: 14px;
}

.modal-field {
    display: grid;
    gap: 6px;
}

.modal-field label {
    font-size: 0.65rem;
    letter-spacing: 0.18em;
    text-transform: uppercase;
    color: var(--app-muted);
}

.modal-field input,
.modal-field select {
    border-radius: 12px;
    border: 1px solid var(--app-border);
    background: var(--app-input);
    color: var(--app-text);
    padding: 10px 12px;
    font-size: 0.85rem;
}

.embed-link-row {
    display: flex;
    align-items: center;
    gap: 10px;
}

.embed-link-row input {
    flex: 1 1 auto;
    min-width: 0;
}

.embed-link-row .btn {
    white-space: nowrap;
}

.select-wrap {
    position: relative;
}

.select-wrap::after {
    content: '';
    position: absolute;
    right: 14px;
    top: 50%;
    width: 8px;
    height: 8px;
    border-right: 2px solid var(--app-muted);
    border-bottom: 2px solid var(--app-muted);
    transform: translateY(-50%) rotate(45deg);
    pointer-events: none;
}

.modal-field select {
    appearance: none;
    padding-right: 36px;
}

.field-note {
    font-size: 0.7rem;
    color: var(--app-muted);
}

.modal-actions {
    display: flex;
    justify-content: flex-end;
    gap: 10px;
}

.delete-modal .delete-confirm {
    border-color: color-mix(in oklab, var(--app-warning) 70%, var(--app-border));
    background: color-mix(in oklab, var(--app-warning) 24%, var(--app-panel));
    color: var(--app-text);
}

.delete-modal .delete-confirm:hover {
    border-color: color-mix(in oklab, var(--app-warning) 90%, var(--app-border));
    background: color-mix(in oklab, var(--app-warning) 32%, var(--app-panel));
}

html[data-theme="light"] .delete-modal .delete-confirm {
    background: color-mix(in oklab, var(--app-warning) 30%, #ffffff);
    border-color: color-mix(in oklab, var(--app-warning) 75%, rgba(18, 24, 38, 0.2));
    color: #5a3b12;
}

.download-overlay {
    position: absolute;
    inset: 0;
    z-index: 12;
    display: grid;
    place-items: center;
    padding: 22px;
}

.download-overlay[hidden] {
    display: none;
}

.download-backdrop {
    position: absolute;
    inset: 0;
    background: rgba(2, 8, 16, 0.68);
    backdrop-filter: blur(2px);
}

html[data-theme="light"] .download-backdrop {
    background: rgba(8, 16, 26, 0.35);
}

.download-modal {
    position: relative;
    width: min(980px, 100%);
    max-height: min(640px, 88%);
    min-height: 0;
    border-radius: 18px;
    border: 1px solid var(--app-border);
    background: color-mix(in oklab, var(--app-panel) 92%, transparent);
    box-shadow: var(--app-shadow);
    padding: 18px;
    display: grid;
    grid-template-rows: auto auto 1fr;
    gap: 16px;
    overflow: hidden;
}

.download-modal .btn {
    padding: 6px 10px;
    font-size: 0.72rem;
    letter-spacing: 0.08em;
    border: 1px solid color-mix(in oklab, var(--app-border) 70%, rgba(255, 255, 255, 0.12));
    background: transparent;
    color: var(--app-text);
    box-shadow:
        inset 0 1px 0 rgba(255, 255, 255, 0.18),
        inset 0 -2px 4px rgba(0, 0, 0, 0.35);
}

.download-modal .btn:hover {
    border-color: color-mix(in oklab, var(--app-accent) 60%, var(--app-border));
    background: linear-gradient(
        180deg,
        color-mix(in oklab, var(--app-panel) 78%, rgba(255, 255, 255, 0.08)),
        color-mix(in oklab, var(--app-panel) 92%, rgba(0, 0, 0, 0.18))
    );
}

.download-header {
    display: flex;
    align-items: flex-start;
    justify-content: space-between;
    gap: 12px;
}

.download-title {
    font-size: 1rem;
    letter-spacing: 0.08em;
    text-transform: uppercase;
    color: var(--app-accent);
}

.download-sub {
    margin-top: 6px;
    font-size: 0.75rem;
    color: var(--app-muted);
}

.download-search {
    display: flex;
    justify-content: center;
}

.download-search input {
    width: 100%;
    max-width: 640px;
    min-height: 42px;
    border-radius: 12px;
    border: 1px solid color-mix(in oklab, var(--app-border) 70%, rgba(255, 255, 255, 0.12));
    background: color-mix(in oklab, var(--app-panel) 86%, transparent);
    color: var(--app-text);
    padding: 8px 12px;
    font-size: 0.8rem;
}

.download-search input:focus {
    outline: 2px solid color-mix(in oklab, var(--app-accent) 60%, transparent);
    outline-offset: 1px;
}

.download-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
    gap: 16px;
    overflow-y: auto;
    overflow-x: hidden;
    padding-right: 4px;
    scrollbar-width: none;
    align-items: stretch;
    min-height: 0;
    max-height: 100%;
}

.download-grid::-webkit-scrollbar {
    width: 0;
    height: 0;
}

.download-card {
    border-radius: 14px;
    border: 1px solid color-mix(in oklab, var(--app-border) 70%, rgba(255, 255, 255, 0.12));
    background: color-mix(in oklab, var(--app-panel) 86%, transparent);
    padding: 14px;
    display: flex;
    flex-direction: column;
    gap: 8px;
    min-height: 190px;
    max-height: 220px;
    overflow: hidden;
    box-shadow:
        inset 0 1px 0 rgba(255, 255, 255, 0.12),
        inset 0 -2px 4px rgba(0, 0, 0, 0.35);
}

.download-card-title {
    font-size: 0.78rem;
    letter-spacing: 0.14em;
    text-transform: uppercase;
    color: var(--app-text);
    font-weight: 600;
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
}

.download-card-desc {
    font-size: 0.7rem;
    color: var(--app-text);
    line-height: 1.4;
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
    overflow-wrap: anywhere;
}

.download-card-publisher {
    font-size: 0.66rem;
    text-transform: uppercase;
    letter-spacing: 0.08em;
    color: var(--app-muted);
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
}

.download-card-meta-line {
    font-size: 0.62rem;
    letter-spacing: 0.06em;
    color: var(--app-muted);
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
}

.download-card-status {
    font-size: 0.62rem;
    letter-spacing: 0.08em;
    text-transform: uppercase;
    color: var(--app-muted);
}

.download-card-status.is-update {
    color: color-mix(in oklab, var(--app-warning) 80%, var(--app-text) 20%);
}

.download-card-date {
    font-size: 0.66rem;
    color: var(--app-muted);
    margin-top: 6px;
}

.download-card-actions {
    margin-top: auto;
    display: flex;
    justify-content: center;
    width: 100%;
}

.download-card-btn {
    min-height: 30px;
    padding: 4px 12px;
    font-size: 0.68rem;
    letter-spacing: 0.08em;
    text-transform: uppercase;
    width: 100%;
    border: 1px solid color-mix(in oklab, var(--app-border) 70%, rgba(255, 255, 255, 0.12));
    background: transparent;
    color: var(--app-text);
    box-shadow:
        inset 0 1px 0 rgba(255, 255, 255, 0.18),
        inset 0 -2px 4px rgba(0, 0, 0, 0.35);
}

.download-card-btn:hover {
    border-color: color-mix(in oklab, var(--app-accent) 60%, var(--app-border));
}

.download-empty {
    border-radius: 14px;
    border: 1px dashed color-mix(in oklab, var(--app-border) 55%, transparent);
    padding: 18px;
    text-align: center;
    color: var(--app-muted);
    font-size: 0.75rem;
}

html[data-theme="light"] .download-modal {
    background: color-mix(in oklab, #ffffff 92%, rgba(255, 255, 255, 0.6));
    border-color: color-mix(in oklab, var(--app-border) 70%, rgba(255, 255, 255, 0.85));
}

html[data-theme="light"] .download-modal .btn {
    border-color: color-mix(in oklab, var(--app-border) 60%, rgba(255, 255, 255, 0.75));
    box-shadow:
        inset 0 1px 0 rgba(255, 255, 255, 0.9),
        inset 0 -1px 0 rgba(18, 24, 38, 0.12);
}

html[data-theme="light"] .download-search input {
    background: rgba(255, 255, 255, 0.9);
    border-color: color-mix(in oklab, var(--app-border) 60%, rgba(255, 255, 255, 0.8));
}

html[data-theme="light"] .download-card {
    background: rgba(255, 255, 255, 0.92);
    border-color: color-mix(in oklab, var(--app-border) 60%, rgba(255, 255, 255, 0.8));
    box-shadow:
        inset 0 1px 0 rgba(255, 255, 255, 0.9),
        inset 0 -1px 0 rgba(18, 24, 38, 0.12);
}

html[data-theme="light"] .download-card-btn {
    border-color: color-mix(in oklab, var(--app-border) 60%, rgba(255, 255, 255, 0.7));
    box-shadow:
        inset 0 1px 0 rgba(255, 255, 255, 0.9),
        inset 0 -1px 0 rgba(18, 24, 38, 0.12);
}


.board-list {
    flex: 1 1 auto;
    min-height: 0;
    max-height: none;
    overflow: auto;
    padding-right: 4px;
    display: grid;
    align-content: flex-start;
    justify-items: stretch;
    gap: 8px;
    scrollbar-width: thin;
    scrollbar-color: color-mix(in oklab, var(--app-border) 60%, transparent) transparent;
}

.board-list::-webkit-scrollbar {
    width: 6px;
}

.board-list::-webkit-scrollbar-track {
    background: transparent;
}

.board-list::-webkit-scrollbar-thumb {
    background: color-mix(in oklab, var(--app-border) 55%, transparent);
    border-radius: 10px;
}

.board-list::-webkit-scrollbar-thumb:hover {
    background: color-mix(in oklab, var(--app-border) 75%, transparent);
}

.board-item {
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 8px;
    padding: 8px 11px;
    max-height: 32px;
    min-height: 28px;
    border-radius: 12px;
    border: 1px solid transparent;
    background: transparent;
    color: var(--app-text);
    font-size: 0.8rem;
    letter-spacing: 0.08em;
    text-transform: none;
    cursor: pointer;
    box-shadow: none;
    transition: border-color 120ms ease, background-color 120ms ease;
    align-self: start;
}

.board-item::before,
.board-item::after {
    content: none;
}

.board-item:hover {
    border-color: color-mix(in oklab, var(--app-border) 58%, transparent);
}

.board-item.active {
    border-color: color-mix(in oklab, var(--app-border) 68%, var(--app-accent) 32%);
    background: transparent;
    box-shadow: none;
    color: var(--app-text);
}

.board-item.editing {
    border-color: var(--app-accent);
    box-shadow: 0 0 12px rgba(95, 234, 255, 0.2);
}

.board-item input {
    width: 100%;
    border-radius: 8px;
    border: 1px solid transparent;
    background: none;
    color: var(--app-text);
    padding: 6px 8px;
    font-size: 0.85rem;
}

.app-stage {
    padding: 16px;
}

.canvas-shell {
    position: relative;
    height: calc(100vh - 32px);
    border-radius: 18px;
    overflow: hidden;
    border: 1px solid var(--app-border);
    box-shadow: inset 0 0 40px rgba(95, 234, 255, 0.08), var(--app-shadow);
    overscroll-behavior: none;
}

.hint-center {
    position: absolute;
    top: 16px;
    right: 64px;
    z-index: 6;
    pointer-events: auto;
}

.hint-icon {
    width: 28px;
    height: 28px;
    border-radius: 999px;
    border: 1px solid var(--app-border);
    background: color-mix(in oklab, var(--app-panel) 88%, transparent);
    color: var(--app-text);
    font-weight: 700;
    font-size: 0.9rem;
    cursor: pointer;
    display: grid;
    place-items: center;
    box-shadow: var(--app-shadow);
}

.hint-panel {
    position: absolute;
    top: 46px;
    right: 0;
    width: min(260px, 40vw);
    border-radius: 14px;
    border: 1px solid var(--app-border);
    background: color-mix(in oklab, var(--app-panel) 88%, transparent);
    box-shadow: var(--app-shadow);
    color: var(--app-text);
    padding: 10px 12px 12px;
}

.hint-panel ul {
    margin: 0;
    padding-left: 18px;
    display: grid;
    gap: 6px;
    font-size: 0.75rem;
    color: var(--app-text);
}

.hint-center.is-collapsed .hint-panel {
    display: none;
}

.panel-expand {
    position: absolute;
    top: 16px;
    left: 16px;
    z-index: 6;
    border: 1px solid var(--app-border);
    background: color-mix(in oklab, var(--app-panel) 88%, transparent);
    color: var(--app-text);
    padding: 8px 12px;
    border-radius: 12px;
    cursor: pointer;
    font-size: 0.7rem;
    text-transform: uppercase;
    letter-spacing: 0.16em;
    display: none;
}

.app-shell.is-collapsed .panel-expand {
    display: inline-flex;
}

.app-shell.is-collapsed .status {
    left: 120px;
}

canvas {
    width: 100%;
    height: 100%;
    display: block;
    touch-action: none;
}

.status {
    position: absolute;
    top: 16px;
    left: 16px;
    height: 32px;
    z-index: 4;
    margin: 0;
    padding: 6px 12px;
    border-radius: 999px;
    border: 1px solid var(--app-border);
    background: color-mix(in oklab, var(--app-panel) 88%, transparent);
    color: var(--app-text);
    font-size: 0.7rem;
    letter-spacing: 0.18em;
    text-transform: uppercase;
}

html[data-theme="light"] .status {
    background: rgba(248, 251, 255, 0.86);
}

.input-bar {
    position: absolute;
    left: 50%;
    transform: translateX(-50%);
    bottom: 18px;
    display: grid;
    grid-template-columns: minmax(200px, 240px) minmax(280px, 1fr) minmax(260px, 340px);
    gap: 18px;
    align-items: stretch;
    padding: 14px 16px;
    border-radius: 16px;
    border: 1px solid color-mix(in oklab, var(--app-border) 60%, rgba(255, 255, 255, 0.12));
    background:
        linear-gradient(120deg, rgba(255, 255, 255, 0.08) 0%, rgba(255, 255, 255, 0) 40%),
        linear-gradient(180deg,
            color-mix(in oklab, var(--app-panel) 92%, rgba(255, 255, 255, 0.06)),
            color-mix(in oklab, var(--app-panel) 78%, rgba(0, 0, 0, 0.22))
        );
    box-shadow:
        inset 0 2px 0 rgba(255, 255, 255, 0.2),
        inset 0 -3px 6px rgba(0, 0, 0, 0.35),
        0 20px 36px rgba(0, 0, 0, 0.35),
        0 0 0 1px rgba(0, 0, 0, 0.12);
    backdrop-filter: blur(10px);
    z-index: 6;
    width: min(980px, calc(100% - 40px));
    pointer-events: auto;
}

.input-bar.is-ai-busy {
    border-color: color-mix(in oklab, var(--app-accent) 65%, var(--app-border));
    animation: inputBarPulse 1.6s ease-in-out infinite;
}

html[data-theme="light"] .input-bar {
    border-color: color-mix(in oklab, var(--app-border) 55%, rgba(255, 255, 255, 0.7));
    background:
        linear-gradient(120deg, rgba(255, 255, 255, 0.65) 0%, rgba(255, 255, 255, 0) 45%),
        linear-gradient(180deg, rgba(255, 255, 255, 0.92), rgba(230, 236, 245, 0.92));
    box-shadow:
        inset 0 2px 0 rgba(255, 255, 255, 0.85),
        inset 0 -3px 6px rgba(18, 24, 38, 0.18),
        0 18px 32px rgba(18, 24, 38, 0.16),
        0 0 0 1px rgba(18, 24, 38, 0.08);
}

html[data-theme="light"] .input-bar.is-ai-busy {
    border-color: color-mix(in oklab, var(--app-accent) 55%, rgba(18, 24, 38, 0.2));
    animation: inputBarPulseLight 1.6s ease-in-out infinite;
}

.input-bar.is-meta-hidden {
    grid-template-columns: minmax(200px, 240px) minmax(280px, 1fr);
}

.input-bar.is-asset-hidden {
    grid-template-columns: minmax(200px, 240px) minmax(280px, 1fr);
}

.input-group {
    display: grid;
    gap: 10px;
    align-content: start;
    padding-right: 16px;
}

.input-group:last-child {
    padding-right: 0;
}

.input-group--asset {
    gap: 12px;
    margin-left: 90px;
}

.input-select,
.input-fields,
.asset-fields {
    display: grid;
    gap: 6px;
}

.input-select {
    position: relative;
}

.input-select label {
    font-size: 0.72rem;
    letter-spacing: 0.18em;
    text-transform: uppercase;
    color: color-mix(in oklab, var(--app-muted) 55%, var(--app-text) 45%);
    font-weight: 600;
}

.input-select select {
    height: 46px;
    border-radius: 12px;
    border: 1px solid color-mix(in oklab, var(--app-border) 85%, transparent);
    background: color-mix(in oklab, var(--app-panel) 88%, transparent);
    color: var(--app-text);
    padding: 10px 34px 10px 12px;
    font-size: 0.85rem;
    font-weight: 600;
    letter-spacing: 0.06em;
    text-transform: uppercase;
    appearance: none;
}

.input-select::after {
    content: '';
    position: absolute;
    right: 14px;
    top: 50%;
    width: 8px;
    height: 8px;
    border-right: 2px solid var(--app-muted);
    border-bottom: 2px solid var(--app-muted);
    transform: translateY(-48%) rotate(45deg);
    pointer-events: none;
}

.input-fields {
    display: flex;
    flex-wrap: wrap;
    align-items: flex-end;
    gap: 16px;
    min-width: 0;
    width: 420px;
}

.node-fields {
    display: flex;
    flex-wrap: wrap;
    align-items: flex-end;
    gap: 12px;
    min-width: 0;
    flex: 1 1 320px;
}

.node-fields.is-code-snippet {
    flex-direction: column;
    align-items: stretch;
}

.code-snippet-row {
    display: flex;
    align-items: flex-end;
    gap: 12px;
    flex-wrap: nowrap;
}

.code-snippet-row .input-field--wide {
    flex: 1 1 auto;
    min-width: 0;
}

.code-snippet-row .input-field--action {
    flex: 0 0 140px;
}

.edge-fields {
    display: none;
    flex-direction: column;
    gap: 6px;
    min-width: 180px;
}

.edge-fields.is-visible {
    display: flex;
}

.edge-fields label {
    font-size: 0.7rem;
    letter-spacing: 0.18em;
    text-transform: uppercase;
    color: color-mix(in oklab, var(--app-muted) 55%, var(--app-text) 45%);
    font-weight: 600;
}

.edge-row {
    display: flex;
    align-items: center;
    gap: 8px;
}

.edge-row input {
    flex: 1;
    min-width: 0;
    border-radius: 10px;
    border: 1px solid var(--app-border);
    background: var(--app-input);
    color: var(--app-text);
    padding: 10px 12px;
    font-size: 0.85rem;
}

.input-field {
    display: grid;
    gap: 6px;
    min-width: 160px;
    flex: 1 1 160px;
}

.input-field--action {
    align-self: center;
    min-width: 140px;
    flex: 0 0 140px;
}

.input-field--action .input-btn {
    width: 100%;
}
.input-field--wide {
    min-width: 260px;
    flex: 2 1 320px;
}

.input-field--wide textarea {
    min-height: 72px;
}

.input-field label {
    font-size: 0.7rem;
    letter-spacing: 0.18em;
    text-transform: uppercase;
    color: color-mix(in oklab, var(--app-muted) 55%, var(--app-text) 45%);
    font-weight: 600;
}

.input-field input,
.input-field textarea,
.input-field select {
    border-radius: 10px;
    border: 1px solid var(--app-border);
    background: var(--app-input);
    color: var(--app-text);
    padding: 10px 12px;
    font-size: 0.85rem;
    min-height: 46px;
}

.input-field input[type="file"] {
    width: 100%;
    min-width: 0;
}

.input-field textarea {
    resize: vertical;
    min-height: 46px;
}

.input-btn {
    width: auto;
    min-width: 56px;
    height: 30px;
    border-radius: 14px;
    border: 1px solid var(--app-border);
    background: color-mix(in oklab, var(--app-panel) 85%, transparent);
    color: var(--app-text);
    font-weight: 600;
    letter-spacing: 0.1em;
    text-transform: uppercase;
    white-space: nowrap;
    padding: 0 16px;
    cursor: pointer;
    transition: transform 0.12s ease, box-shadow 0.12s ease, border-color 0.12s ease;
}

.input-btn.icon-only {
    min-width: 34px;
    width: 34px;
    height: 34px;
    padding: 0;
    border-radius: 50%;
    display: grid;
    place-items: center;
}

.input-btn.icon-only svg {
    width: 16px;
    height: 16px;
    stroke: currentColor;
    fill: none;
}

.input-btn.icon-only.has-file {
    border-color: var(--app-accent);
    box-shadow: 0 0 12px rgba(95, 234, 255, 0.25);
}

.input-btn:hover:enabled {
    transform: translateY(-1px);
    box-shadow: 0 0 16px rgba(95, 234, 255, 0.2);
    border-color: var(--app-accent);
}

.input-btn.secondary {
    background: transparent;
    border-color: color-mix(in oklab, var(--app-border) 85%, transparent);
    color: var(--app-text);
}

.input-btn.primary {
    background: linear-gradient(135deg, rgba(95, 234, 255, 0.24), rgba(59, 255, 177, 0.2));
    border-color: color-mix(in oklab, var(--app-accent) 60%, var(--app-border));
    min-width: 76px;
}

.input-btn.is-busy {
    border-color: var(--app-accent);
    box-shadow: 0 0 16px rgba(95, 234, 255, 0.28);
    animation: sendPulse 1.2s ease-in-out infinite, sendJiggle 2.2s ease-in-out infinite;
}

@keyframes sendPulse {
    0% {
        box-shadow: 0 0 12px rgba(95, 234, 255, 0.18);
    }
    50% {
        box-shadow: 0 0 20px rgba(95, 234, 255, 0.32);
    }
    100% {
        box-shadow: 0 0 12px rgba(95, 234, 255, 0.18);
    }
}

@keyframes sendJiggle {
    0%,
    100% {
        transform: translateY(0) rotate(0deg);
    }
    30% {
        transform: translateY(-1px) rotate(-1deg);
    }
    60% {
        transform: translateY(0) rotate(1deg);
    }
}

@keyframes inputBarPulse {
    0%,
    100% {
        box-shadow:
            inset 0 2px 0 rgba(255, 255, 255, 0.2),
            inset 0 -3px 6px rgba(0, 0, 0, 0.35),
            0 20px 36px rgba(0, 0, 0, 0.35),
            0 0 0 1px rgba(0, 0, 0, 0.12);
    }
    50% {
        box-shadow:
            inset 0 2px 0 rgba(255, 255, 255, 0.24),
            inset 0 -4px 8px rgba(0, 0, 0, 0.42),
            0 24px 42px rgba(0, 0, 0, 0.42),
            0 0 0 1px rgba(0, 0, 0, 0.12),
            0 0 22px rgba(95, 234, 255, 0.25);
    }
}

@keyframes inputBarPulseLight {
    0%,
    100% {
        box-shadow:
            inset 0 2px 0 rgba(255, 255, 255, 0.85),
            inset 0 -3px 6px rgba(18, 24, 38, 0.18),
            0 18px 32px rgba(18, 24, 38, 0.16),
            0 0 0 1px rgba(18, 24, 38, 0.08);
    }
    50% {
        box-shadow:
            inset 0 2px 0 rgba(255, 255, 255, 0.92),
            inset 0 -4px 8px rgba(18, 24, 38, 0.22),
            0 20px 36px rgba(18, 24, 38, 0.22),
            0 0 0 1px rgba(18, 24, 38, 0.08),
            0 0 18px rgba(95, 234, 255, 0.2);
    }
}

@media (prefers-reduced-motion: reduce) {
    .input-btn.is-busy {
        animation: none;
    }
    .input-bar.is-ai-busy {
        animation: none;
    }
}

.input-btn.is-recording {
    background: linear-gradient(135deg, rgba(255, 110, 110, 0.3), rgba(255, 110, 110, 0.1));
    border-color: rgba(255, 110, 110, 0.6);
    box-shadow: 0 0 18px rgba(255, 110, 110, 0.35);
}

.input-btn:disabled {
    opacity: 0.45;
    cursor: not-allowed;
}

.asset-actions {
    /* display: flex; */
    align-items: center;
    justify-content: flex-end;
    gap: 10px;
    margin-top: 15px;
}

.file-picker {
    display: flex;
    align-items: center;
    gap: 25px;
    flex-wrap: wrap;
    margin-top: 10px;
}

.input-file {
    display: none;
}

.file-chip {
    max-width: 180px;
    border-radius: 999px;
    border: 1px solid color-mix(in oklab, var(--app-border) 80%, transparent);
    background: color-mix(in oklab, var(--app-panel) 85%, transparent);
    padding: 6px 10px;
    font-size: 0.7rem;
    color: var(--app-text);
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
}

.file-meta {
    font-size: 0.7rem;
    color: var(--app-muted);
}

.input-note {
    font-size: 0.7rem;
    color: var(--app-muted);
}

.ew-html-text-editor {
    white-space: pre-wrap;
    overflow-wrap: anywhere;
    word-break: break-word;
}

.ew-code-block {
    flex: 1 1 auto;
    min-height: 0;
    max-height: 500px;
    overflow-y: auto;
    overflow-x: hidden;
}

.ew-code-snippet {
    display: flex;
    flex-direction: column;
    height: 100%;
    overflow: hidden;
}

.ew-preview-pill {
    border: 1px solid color-mix(in oklab, var(--app-border) 70%, transparent);
    background: color-mix(in oklab, var(--app-panel) 85%, transparent);
    color: var(--app-text);
    font-size: 0.6rem;
    letter-spacing: 0.14em;
    text-transform: uppercase;
    padding: 4px 8px;
    border-radius: 999px;
    cursor: pointer;
    transition: border-color 120ms ease, box-shadow 120ms ease, transform 120ms ease;
    pointer-events: auto;
}

.ew-preview-pill:hover {
    border-color: var(--app-accent);
    box-shadow: 0 0 10px rgba(95, 234, 255, 0.25);
    transform: translateY(-1px);
}

.ew-html-node .ew-node-header .ew-preview-pill {
    margin-left: auto;
    margin-right: 10px;
}

.ew-html-text .ew-preview-pill {
    position: absolute;
    top: 8px;
    right: 8px;
    z-index: 3;
}

.file-chip--ai {
    max-width: 200px;
    background: transparent;
    border-color: transparent;
    padding: 0;
    font-size: 0.68rem;
    color: var(--app-muted);
}

.file-chip--ai.is-empty {
    display: none;
}

.ew-code-snippet .ew-node-body {
    display: flex;
    flex-direction: column;
    flex: 1;
    min-height: 0;
}

.ew-markdown {
    display: flex;
    flex-direction: column;
    height: 100%;
}

.ew-html-preview {
    display: flex;
    flex-direction: column;
    height: 100%;
}

.ew-html-preview .ew-node-header {
    position: relative;
    z-index: 2;
    pointer-events: auto;
}

.ew-html-preview-body {
    position: relative;
    display: flex;
    flex: 1 1 auto;
    min-height: 0;
    overflow: hidden;
    padding: 10px;
    z-index: 1;
}

.ew-html-preview-edge {
    position: absolute;
    background: rgba(0, 0, 0, 0.001);
    pointer-events: auto;
    touch-action: none;
    z-index: 6;
}

.ew-html-preview-edge.is-top {
    top: 0;
    left: 0;
    right: 0;
    height: 16px;
    cursor: ns-resize;
}

.ew-html-preview-edge.is-bottom {
    bottom: 0;
    left: 0;
    right: 0;
    height: 16px;
    cursor: ns-resize;
}

.ew-html-preview-edge.is-left {
    top: 0;
    bottom: 0;
    left: 0;
    width: 16px;
    cursor: ew-resize;
}

.ew-html-preview-edge.is-right {
    top: 0;
    bottom: 0;
    right: 0;
    width: 16px;
    cursor: ew-resize;
}

.ew-html-preview-edge.is-corner {
    width: 24px;
    height: 24px;
}

.ew-html-preview-edge.is-ne {
    top: 0;
    right: 0;
    cursor: nesw-resize;
}

.ew-html-preview-edge.is-nw {
    top: 0;
    left: 0;
    cursor: nwse-resize;
}

.ew-html-preview-edge.is-se {
    bottom: 0;
    right: 0;
    cursor: nwse-resize;
}

.ew-html-preview-edge.is-sw {
    bottom: 0;
    left: 0;
    cursor: nesw-resize;
}

.ew-html-preview-frame {
    position: relative;
    z-index: 1;
    width: 100%;
    height: 100%;
    border: 0;
    background: transparent;
}

.ew-html-preview-placeholder {
    width: 100%;
    color: var(--app-muted);
    font-size: 0.8rem;
    line-height: 1.4;
}

.ew-markdown-body {
    display: flex;
    flex-direction: column;
    gap: 10px;
    overflow: auto;
    font-size: 0.85rem;
    line-height: 1.55;
}

.ew-markdown-body h1,
.ew-markdown-body h2,
.ew-markdown-body h3,
.ew-markdown-body h4 {
    margin: 0 0 4px;
    color: var(--app-text);
}

.ew-markdown-body p {
    margin: 0;
    color: var(--app-text);
}

.ew-markdown-body ul,
.ew-markdown-body ol {
    margin: 0 0 4px 18px;
    padding: 0;
    color: var(--app-text);
}

.ew-markdown-body li {
    margin-bottom: 4px;
}

.ew-markdown-body code {
    font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
    font-size: 0.82rem;
    padding: 2px 4px;
    border-radius: 6px;
    background: color-mix(in oklab, var(--app-panel) 65%, var(--app-accent) 12%);
    border: 1px solid color-mix(in oklab, var(--app-border) 70%, transparent);
}

.ew-markdown-body pre {
    margin: 0;
    padding: 10px 12px;
    border-radius: 10px;
    background: color-mix(in oklab, var(--app-panel) 80%, transparent);
    border: 1px solid color-mix(in oklab, var(--app-border) 75%, transparent);
    overflow: auto;
}

.ew-markdown-body pre code {
    display: block;
    padding: 0;
    border: none;
    background: transparent;
    font-size: 0.8rem;
    white-space: pre;
}

.ew-svg,
.ew-mermaid {
    display: flex;
    flex-direction: column;
    height: 100%;
}

.ew-svg-body,
.ew-mermaid-body {
    display: flex;
    flex: 1;
    align-items: center;
    justify-content: center;
    overflow: auto;
    color: var(--app-text);
    font-size: 0.82rem;
    line-height: 1.5;
    white-space: pre-wrap;
}

.ew-svg-body svg {
    display: block;
    max-width: 100%;
    height: auto;
}

.ew-mermaid-body {
    align-items: flex-start;
    justify-content: flex-start;
}

.ew-mermaid-body svg {
    display: block;
    max-width: none !important;
    height: auto;
}

.ew-mermaid .ew-node-header {
    gap: 8px;
}

.ew-mermaid-controls {
    margin-left: auto;
    display: inline-flex;
    align-items: center;
    gap: 4px;
    pointer-events: auto;
}

.ew-mermaid-control {
    border: 1px solid color-mix(in oklab, var(--app-border) 75%, transparent);
    background: color-mix(in oklab, var(--app-panel) 84%, transparent);
    color: var(--app-text);
    border-radius: 8px;
    min-height: 22px;
    padding: 0 6px;
    font-size: 0.62rem;
    letter-spacing: 0.06em;
    line-height: 1;
    cursor: pointer;
}

.ew-mermaid-control:hover:not(:disabled) {
    border-color: color-mix(in oklab, var(--app-accent) 65%, var(--app-border));
}

.ew-mermaid-control:disabled {
    opacity: 0.45;
    cursor: default;
}

.ew-mermaid-zoom-label {
    min-width: 42px;
    text-align: right;
    font-size: 0.62rem;
    letter-spacing: 0.08em;
    color: var(--app-muted);
}

.ew-svg-body.is-loading,
.ew-mermaid-body.is-loading {
    color: var(--app-muted);
}

.ew-mermaid-body.is-loading {
    align-items: center;
    justify-content: center;
}

.ew-svg-body.is-error,
.ew-mermaid-body.is-error {
    align-items: flex-start;
    justify-content: flex-start;
    color: var(--app-warning);
    font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
}

.app-panel .btn {
    /* border-color: color-mix(in oklab, var(--app-border) 85%, var(--app-accent) 25%); */
    /* background: color-mix(in oklab, var(--app-panel) 86%, transparent); */
    color: var(--app-text);
    box-shadow: 0 10px 18px rgba(0, 0, 0, 0.18);
}

.app-panel .btn.is-live {
    position: relative;
    padding-left: 26px;
}

.app-panel .btn.is-live::before {
    content: '';
    position: absolute;
    left: 10px;
    top: 50%;
    width: 8px;
    height: 8px;
    border-radius: 50%;
    transform: translateY(-50%);
    background: var(--app-accent-2);
    box-shadow: 0 0 8px color-mix(in oklab, var(--app-accent-2) 60%, transparent);
}

.app-panel .btn.is-live.is-speaking::before {
    background: var(--app-accent);
    box-shadow: 0 0 12px color-mix(in oklab, var(--app-accent) 70%, transparent);
    animation: ew-realtime-pulse 1.1s ease-in-out infinite;
}

.app-panel #btnNew,
.app-panel #btnNewProject {
    background: linear-gradient(
        180deg,
        color-mix(in oklab, var(--app-accent) 86%, #ffffff 14%),
        color-mix(in oklab, var(--app-accent) 96%, #ffffff 4%) 55%,
        color-mix(in oklab, var(--app-accent) 84%, #112419 16%)
    );
    border-color: var(--app-accent);
    color: #102218;
    box-shadow:
        0 7px 14px color-mix(in oklab, var(--app-accent) 20%, transparent),
        0 0 0 1px color-mix(in oklab, var(--app-accent) 20%, transparent);
}

html[data-theme="light"] .app-panel .btn {
    /* background: color-mix(in oklab, #ffffff 85%, var(--app-accent) 10%); */
    /* border-color: color-mix(in oklab, var(--app-border) 80%, var(--app-accent) 35%); */
    box-shadow: 0 8px 14px rgba(18, 24, 38, 0.08);
}

html[data-theme="light"] .app-panel #btnNew,
html[data-theme="light"] .app-panel #btnNewProject {
    background: linear-gradient(
        180deg,
        color-mix(in oklab, var(--app-accent) 84%, #ffffff 16%),
        color-mix(in oklab, var(--app-accent) 92%, #ffffff 8%) 54%,
        color-mix(in oklab, var(--app-accent) 78%, #1f6b4e 22%)
    );
    color: #ffffff;
    box-shadow:
        0 6px 12px color-mix(in oklab, var(--app-accent) 20%, transparent),
        0 0 0 1px color-mix(in oklab, var(--app-accent) 16%, transparent);
}

@keyframes ew-realtime-pulse {
    0% {
        transform: translateY(-50%) scale(1);
        opacity: 0.9;
    }
    50% {
        transform: translateY(-50%) scale(1.3);
        opacity: 1;
    }
    100% {
        transform: translateY(-50%) scale(1);
        opacity: 0.9;
    }
}

.app-panel .btn.ghost {
    background: transparent;
    border-color: color-mix(in oklab, var(--app-border) 80%, transparent);
}

html[data-theme="light"] .app-panel .btn.ghost {
    border-color: color-mix(in oklab, var(--app-border) 70%, var(--app-accent) 20%);
    color: var(--app-text);
}

.ew-hand-cursor {
    position: fixed;
    left: 0;
    top: 0;
    width: 18px;
    height: 18px;
    margin-left: -9px;
    margin-top: -9px;
    border-radius: 50%;
    border: 2px solid color-mix(in oklab, var(--app-accent) 78%, #ffffff 22%);
    background: color-mix(in oklab, var(--app-accent) 26%, transparent);
    box-shadow:
        0 0 0 1px rgba(0, 0, 0, 0.35),
        0 0 14px color-mix(in oklab, var(--app-accent) 45%, transparent);
    pointer-events: none;
    opacity: 0;
    transform: translate(-1000px, -1000px);
    transition: opacity 120ms ease, width 120ms ease, height 120ms ease, margin 120ms ease;
    z-index: 9999;
}

.ew-hand-cursor.is-visible {
    opacity: 0.95;
}

.ew-hand-cursor.is-pinching {
    width: 24px;
    height: 24px;
    margin-left: -12px;
    margin-top: -12px;
    border-color: color-mix(in oklab, var(--app-accent-2) 75%, #ffffff 25%);
    background: color-mix(in oklab, var(--app-accent-2) 34%, transparent);
}

@media (max-width: 1100px) {
    .app-shell {
        grid-template-columns: 1fr;
    }

    .app-panel {
        border-right: none;
        border-bottom: 1px solid var(--app-border);
        max-height: none;
    }

    .canvas-shell {
        height: 70vh;
    }

    .input-bar {
        width: min(760px, calc(100% - 40px));
        grid-template-columns: 1fr;
        gap: 12px;
    }

    .input-group {
        padding-right: 0;
        border-right: none;
    }
}

@media (max-width: 720px) {
    .input-bar {
        grid-template-columns: 1fr;
        gap: 8px;
        padding: 10px 12px;
    }

    .input-btn {
        width: 100%;
        height: 42px;
    }

    .input-group {
        padding-right: 0;
        border-right: none;
    }

    .asset-actions {
        flex-direction: column;
        align-items: stretch;

    }
}
